<!DOCTYPE html> <html lang="zh"> <head> <title>网易音乐</title> <meta charset="utf-8"/> <link href="./core.css?243778e6c5bbaa5c570d0bbed0205ac2" type="text/css" rel="stylesheet"/>     <link rel="stylesheet" href="" id="skin-frame-node">     <link rel="stylesheet" href="" id="skin-dark-node">     <link rel="stylesheet" href="" id="skin-light-node"> </head> <body id="music-163-com" style="overflow:hidden"> <div class="m-install"> <div class="barbg"><div class="bar j-flag"></div></div> <div class="note j-flag"></div> <div class="note note1">升级需要清除用户数据<a href="javascript:;" id="clearData" style="color:#00e;">立即清除</a></div> <div class="fbox"> <p>[<span id="x-id-update-error-code"></span>]抱歉，数据升级失败！请卸载并不保留用户数据，重新安装</p> <label> <input type="checkbox" class="j-flag"/><span></span>发送失败信息 </label> <button class="j-flag">退出</button> </div> </div> <script src="./core.js?d6f6bc0297f47c85393f12f01df02f16" type="text/javascript"></script><script type="text/javascript">(function(){var byz=NEJ.P,cJO=NEJ.O,byA=byz("nej.e"),bm=byz("nej.u"),bi=byz("nej.v"),bD=byz("nej.n"),bU=byz("nej.ut"),bj=byz("nm.x"),bp=byz("nm.d"),byp=byz("app"),bCk=100,dK={queue:"NM_QUEUE",local:"NM_LOCAL",local2:"NM_LOCAL_2",track:"NM_TRACK",history:"NM_HISTORY",offline:"NM_OFFLINE",version:"NM_DATA_VERSION",state:"NM_DATA_UPDATE_STATE",program:"NM_PROGRAM",localCount:"NM_LOCAL_TRACK_COUNT",playlistOfflineTrack:"NM_PLAYLIST_OFFLINE",newalbum:"newalbum-week-list"},byx,byD;bj.bWH=NEJ.C();byx=bj.bWH.bS(bU.fQ);byx.byR=function(blZ){this.bEc(blZ);this.bVD=bj.bUi.bG();this.bUR=bj.bUj.bG();this.hP=bp.gO.bG();this.cbX=0;this.cbW=1;bi.bM(bj.bUi,"sql",this.bXT.byB(this));bi.bM(bj.bUj,"io",this.bXR.byB(this));bi.bM(bp.gO,"initstorage",this.bYz.byB(this));bD.fo("enumofflinetracks","storage",this.bYy.byB(this),1);bD.fo("querylibraryversion","musiclibrary",this.bYx.byB(this));this.bXD=!1;this.bVB=[];this.hP.bpF()};byx.mD=function(){var bXv=!1;return function(){if(bXv)return;bXv=!0;this.bXs()}}();byx.bXs=function(){var byj=[{ver:0,step:0},{ver:20140212,step:16},{ver:20140416,step:2},{ver:20141009,step:4},{ver:20150115,step:1}],bXv=!1;return function(bYw){try{var bVA=JSON.parse(localStorage.getItem(dK.version))||0}catch(e){this.bJK("err","检查数据版本号出现错误，数据升级无法进行！",10001);return}var bs=bm.eT(byj,function(bl){return bl.ver==bVA},this);if(bs<0){this.bJK("err","数据错乱，数据版本高于最新版本，请检查版本是否是最新版本！",10002);return}if(!bXv){bXv=!0;var cbU=1;for(var i=bs+1,l=byj.length;i<l;i++){cbU+=byj[i].step}this.cbW=cbU}for(var i=bs,l=byj.length;i<l;i++){if(bVA<byj[i].ver){this.bOH(bVA,byj[i].ver,!0);return}}this.bJK("suc","升级成功！")}}();byx.bOH=function(){var byF={20140212:{0:function(){this.bWl(dK.state,1);this.bYq()}},20140416:{20140212:function(){this.bWl(dK.state,1);this.cdI()}},20141009:{20140416:function(){this.bWl(dK.state,1);this.cvS()}},20150115:{20141009:function(){this.bWl(dK.state,1);this.cDW()}}};return function(bXO,bHG,bYw){var bUk=byF[bHG];if(!bUk){this.bJK("err","要升级的数据版本("+bHG+")不存在",10003);return}var bWG=bUk[bXO];if(!bWG){this.bJK("err","数据版本("+bXO+")升级到("+bHG+")的方法不存在",10004);return}bWG.call(this)}}();byx.bXT=function(bn){if(!bn||!bn.id)return;switch(bn.id){case"create 20140212 table":if(bn.err==0){this.bYp()}else{this.bJK("err","创建下载表失败，无法进行数据升级！",10005)}break;case"save 20140212 offline data":if(bn.err==0){this.bJK("tip","开始检查本地音乐表是否需要升级");bD.bX("musiclibrary.queryLibraryVersion")}else{this.bJK("warn","保存下载数据到数据库失败！")}break;case"get 20140212 local data":if(bn.err==0){if(!!bn.ret&&!!bn.ret.length){this.bYo(bn.ret)}else{this.bVy()}}else{this.bJK("warn","获取本地音乐数据失败")}break;case"save 20140212 local data":if(bn.err==0){this.bVy()}else{this.bJK("warn","保存本地数据到数据库失败！")}break;case"check 20140212 table":if(bn.err==0){this.cdx()}else{this.bJK("err","检查20140212表失败",10006)}break;case"update 20140416 table web_offline_track":if(bn.err==0){this.bWl(dK.version,20140416);this.bWl(dK.state,2);this.bXs()}else{this.bJK("err","升级下载列表失败！",10007)}break;case"create 20141009 table":if(bn.err==0){this.czJ()}else{this.bJK("err","创建20141009新表失败！",14100901)}break;case"copyfiledatatodb":this.cAX();break;case"update 20150115 table web_cloud_track":if(bn.err==0){this.bWl(dK.version,20150115);this.bWl(dK.state,2);this.bXs()}else{this.bJK("err","升级云歌曲表失败！",15011501)}break}};byx.bXR=function(bn){if(!bn||!bn.id)return;switch(bn.id){case"test write 20140212 io":if(bn.err==0){this.bYn()}else{delete this.bVc;delete this.bVa;this.bJK("err","无法写入文件，写文件能力缺乏！",10008)}break;case"test read 20140212 io":if(bn.err==0){var cv=bn.ret;if(cv==this.bVa){this.bYm();this.bYl(this.bYk)}else{this.bJK("err","读写不一致，写入文件为("+this.bVa+")，读出文件为("+cv+")",10009)}}else{this.bJK("err","无法读出文件，读文件能力缺乏！",10010)}this.bUR.bgB("delete test file",this.bVc);delete this.bVc;delete this.bVa;break;case"save 20140212 queue data":if(bn.err==0){this.bYj()}else{this.bJK("warn","保存播放列表到文件失败")}break;case"save 20140212 history data":if(bn.err==0){this.bYi()}else{this.bJK("warn","保存播放列表到文件失败")}break;case"save 20140212 playlist data":var dJ=this.bUh.playlist;dJ.ioCount--;if(bn.err)dJ.err=bn.err;if(dJ.ioCount<=0){if(dJ.err){this.bJK("warn","保存左侧歌单信息到文件失败")}else{this.bWl(dK.version,20140212);this.bXS()}}break;case"scan playlist folder 20141009":this.cBd(bn);break;case"copyfiledata":this.cBc(bn);break}};byx.bYq=function(){this.bJK("tip","开始创建表");var byF={version:20140212,tables:[{name:"web_offline_track",createSQL:"DROP TABLE IF EXISTS `web_offline_track`;CREATE TABLE IF NOT EXISTS `web_offline_track` (`id` VARCHAR(40) NOT NULL, `type` INT NULL, `type_extra` BIGINT NULL, `track_id` BIGINT NULL, `detail` TEXT NULL, `size` INT NULL, `dfsid` BIGINT NULL, `bitrate` INT NULL, `state` INT NULL, `download_time` INT NULL, `complete_time` INT NULL, `source_href` TEXT NULL, `source_text` TEXT NULL, `source_extra` TEXT NULL, `album_id` VARCHAR(40) NULL, `relative_path` TEXT NULL, `track_name` TEXT NULL, `artist_name` TEXT NULL, `album_name` TEXT NULL, PRIMARY KEY (`id`)); CREATE INDEX IF NOT EXISTS `index_track_name` ON `web_offline_track` (`track_name` ASC); CREATE INDEX IF NOT EXISTS `index_artist_name` ON `web_offline_track` (`artist_name` ASC); CREATE INDEX IF NOT EXISTS `index_album_name` ON `web_offline_track` (`album_name` ASC); CREATE INDEX IF NOT EXISTS `index_size` ON `web_offline_track` (`size` ASC); CREATE INDEX IF NOT EXISTS `index_download_time` ON `web_offline_track` (`download_time` ASC); CREATE INDEX IF NOT EXISTS `index_complete_time` ON `web_offline_track` (`complete_time` ASC);"},{name:"web_playlist_order",createSQL:"DROP TABLE IF EXISTS `web_playlist_order`;CREATE TABLE IF NOT EXISTS `web_playlist_order` (`playlist_id` BIGINT NOT NULL, `field` VARCHAR(40) NULL, `order` VARCHAR(40) NULL, PRIMARY KEY (`playlist_id`));"},{name:"web_map",createSQL:"DROP TABLE IF EXISTS `web_map`;CREATE TABLE IF NOT EXISTS `web_map` (`key` TEXT NOT NULL, `value` TEXT NULL, PRIMARY KEY (`key`));"}]};this.bVD.bTX("create 20140212 table",function(){var bTR="";byF.tables.forEach(function(bl){bTR+=bl.createSQL});return bTR}())};byx.bYp=function(){this.bJK("tip","开始测试文件写入能力");this.bVc="test_20140212_io_"+ +(new Date);this.bVa="20140212";this.bUR.bUt("test write 20140212 io",this.bVc,this.bVa)};byx.bYn=function(){this.bJK("tip","开始测试文件读取能力");this.bUR.bUK("test read 20140212 io",this.bVc)};byx.bYm=function(){this.bJK("tip","开始获取localstorage中数据");this.bUh={offline:[],queue:[],history:[],track:this.bUW(dK.track,{}),program:this.bUW(dK.program,{}),playlist:[]};var bUB=this.bUh.track;for(var i=0;i<bCk;i++){var bVt=this.bUW(dK.track+"_"+i,{});for(var x in bVt){if(!!bUB[x]){bUB[x]=NEJ.X(bUB[x],bVt[x])}else{bUB[x]=bVt[x]}}bVt=null}var bYh=this.bUh.program;for(var x in bUB){var bB=bUB[x];if(!!bB.programId&&(bB.id+"").indexOf("offline-")!=0){var dB=bYh[bB.programId];if(dB){bB.program=dB}else{console.warn("program main track miss program",bB.programId);delete bUB[x]}}}var bzl=["queue","history","offline"];while(bzl.length){var bN=bzl.shift(),bYg=this.bUh[bN],bg=this.bUW(dK[bN],[]);bm.cj(bg,function(bl){var bh=bUB[bl.id||bl];if(!bh){bh=NEJ.X({},bl);bh.track=bUB[bh.tid]}if(!!bh.tid&&!bh.track)return;bYg.push(bh)},this)}var dJ=this.bUh.playlist;for(var x in localStorage){var bq=x.indexOf("NM_PLAYLIST_FAV_")==0?"fav":x.indexOf("NM_PLAYLIST_NEW_")==0?"new":"";if(bq){var bu="playlist_"+bq+"-"+x.substr(16);dJ.push({lsKey:x,key:bu})}}};byx.bYk=function(){this.bJK("tip","开始获取native offline data");bD.bX("storage.enumOfflineTracks")};byx.bYy=function(dR,bg){this.bJK("tip","开始合并localstorage offline data 与 native offline data");var gR=bg,fA=this.bUh["offline"];bm.cj(gR,function(bXq){var bs=bm.eT(fA,function(bYf){return bYf.tid==bXq.trackid},this);if(bs>=0){NEJ.X(fA[bs],bXq)}},this);this.bYe()};byx.bYe=function(){this.bJK("tip","开始保存offline data to db");var fA=this.bUh["offline"]||[];var bg=[],cV=+(new Date);bm.cj(fA,function(bl){if(logger&&logger.info){logger.info("state="+bl.state+"|path="+bl.relativepath,"updatedata.js","__saveOfflineData")}var yI=!!bl.relativepath,dB=!!bl.programId;bg.push({id:bl.id,type:dB?1:0,type_extra:dB?bl.programId:null,track_id:bl.tid,detail:bl.track,size:bl.size,dfsid:bl.dfsId,bitrate:bl.bitrate,state:yI?4:bl.state&&bl.state!=4?bl.state:1,download_time:bl.download?bl.download:cV,complete_time:bl.complete?bl.complete:cV,source_href:bl.href?bl.href:"",source_text:bl.text?bl.text:"",source_extra:bl.nickName?bl.nickName:"",album_id:dB?"program"+bl.programId:"album"+(((bl.track||cJO).album||cJO).id||0),relative_path:bl.relativepath,track_name:(bl.track||cJO).name,artist_name:(((bl.track||cJO).artists||cJO)[0]||cJO).name,album_name:((bl.track||cJO).album||cJO).name})},this);var bTR=this.bYd("web_offline_track",bg);if(!!bTR){this.bVD.bTX("save 20140212 offline data",bTR,!0)}else{this.bXT({id:"save 20140212 offline data",err:0})}};byx.bYx=function(bzg){if(bzg.result){if(bzg.need_update){if(bzg.cur_version==2){this.bJK("tip","开始获取本地音乐数据");this.bVD.bUf("get 20140212 local data",["select * from track;"])}else{this.bJK("err","无法升级本地音乐到版本"+bzg.cur_version,10011)}}else{this.bVy()}}else{this.bJK("err","检查本地音乐版本失败",10012)}};byx.bYo=function(bg){this.bJK("tip","开始合并localstorage local data 与 native local data");var hF=this.bUh.track,bTR=[];bm.cj(bg,function(bl){var fk=bl[1],bB=hF[fk];if(!!fk){if(!!bB){var bWx=bj.bWS(bB.artists);bTR.push("update track set artist = '"+this.bUC(bWx.artStr)+"', artistid = '"+this.bUC(bWx.idsStr)+"', track = '"+this.bUC(JSON.stringify(bB))+"' where file == '"+this.bUC(bl[0])+"';")}else{bTR.push("update track set tid = '', aid = '' where file == '"+this.bUC(bl[0])+"';")}}},this);if(!!bTR.length){this.bVD.bUf("save 20140212 local data",bTR)}else{this.bVy()}};byx.bVy=function(){this.bJK("tip","开始保存播放列表数据");this.bUR.bUt("save 20140212 queue data","queue",this.bUh["queue"])};byx.bYj=function(){this.bJK("tip","开始保存历史记录数据");this.bUR.bUt("save 20140212 history data","history",this.bUh["history"])};byx.bYi=function(){this.bJK("tip","开始保存左侧歌单数据");var dJ=this.bUh.playlist;dJ.ioCount=dJ.length;if(!!dJ.ioCount){bm.cj(dJ,function(bl){this.bUR.bUt("save 20140212 playlist data",bl.key,this.bYc(bl.lsKey))},this)}else{this.bXR({id:"save 20140212 playlist data",err:0})}};byx.bXS=function(){this.bJK("tip","开始清理辅助数据");this.bJK("tip","开始清理localStorage中数据");bm.cj((this.bUh||{}).playlist,function(bl){this.bUH(bl.lsKey)},this);delete this.bUh;this.bUH(dK.track);for(var i=0;i<bCk;i++){this.bUH(dK.track+"_"+i)}var bzl=["queue","history","offline"];while(bzl.length){this.bUH(dK[bzl.shift()])}this.bUH(dK.local);this.bUH(dK.local2);this.bUH(dK.program);this.bUH(dK.localCount);this.bUH(dK.playlistOfflineTrack);this.bUH(dK.newalbum);this.bJK("tip","开始清理native中数据");this.bWl(dK.state,2);this.bXs()};byx.cdI=function(){this.bJK("tip","检查20140212表");var byF={version:20140416,tables:[{name:"web_offline_track",checkSQL:"CREATE TABLE IF NOT EXISTS `web_offline_track` (`id` VARCHAR(40) NOT NULL, `type` INT NULL, `type_extra` BIGINT NULL, `track_id` BIGINT NULL, `detail` TEXT NULL, `size` INT NULL, `dfsid` BIGINT NULL, `bitrate` INT NULL, `state` INT NULL, `download_time` INT NULL, `complete_time` INT NULL, `source_href` TEXT NULL, `source_text` TEXT NULL, `source_extra` TEXT NULL, `album_id` VARCHAR(40) NULL, `relative_path` TEXT NULL, `track_name` TEXT NULL, `artist_name` TEXT NULL, `album_name` TEXT NULL, PRIMARY KEY (`id`)); CREATE INDEX IF NOT EXISTS `index_track_name` ON `web_offline_track` (`track_name` ASC); CREATE INDEX IF NOT EXISTS `index_artist_name` ON `web_offline_track` (`artist_name` ASC); CREATE INDEX IF NOT EXISTS `index_album_name` ON `web_offline_track` (`album_name` ASC); CREATE INDEX IF NOT EXISTS `index_size` ON `web_offline_track` (`size` ASC); CREATE INDEX IF NOT EXISTS `index_download_time` ON `web_offline_track` (`download_time` ASC); CREATE INDEX IF NOT EXISTS `index_complete_time` ON `web_offline_track` (`complete_time` ASC);"},{name:"web_playlist_order",checkSQL:"CREATE TABLE IF NOT EXISTS `web_playlist_order` (`playlist_id` BIGINT NOT NULL, `field` VARCHAR(40) NULL, `order` VARCHAR(40) NULL, PRIMARY KEY (`playlist_id`));"},{name:"web_map",checkSQL:"CREATE TABLE IF NOT EXISTS `web_map` (`key` TEXT NOT NULL, `value` TEXT NULL, PRIMARY KEY (`key`));"}]};this.bVD.bTX("check 20140212 table",function(){var bTR="";byF.tables.forEach(function(bl){bTR+=bl.checkSQL});return bTR}())};byx.cdx=function(){this.bJK("tip","开始升级下载表结构");this.bVD.bTX("update 20140416 table web_offline_track","ALTER TABLE `web_offline_track` ADD COLUMN `id3_state` INT DEFAULT 0;")};byx.cvS=function(){this.bJK("tip","开始创建20141009表");var byF={version:20141009,tables:[{name:"web_track",createSQL:'DROP TABLE IF EXISTS `web_track`;CREATE TABLE IF NOT EXISTS `web_track` (`tid` INTERGER NOT NULL, `version` INTERGER NOT NULL DEFAULT 0, `track` TEXT NOT NULL DEFAULT "", PRIMARY KEY (`tid`));'},{name:"web_playlist_track",createSQL:"DROP TABLE IF EXISTS `web_playlist_track`;CREATE TABLE IF NOT EXISTS `web_playlist_track` (`pid` INTERGER NOT NULL DEFAULT 0, `tid` INTERGER NOT NULL DEFAULT 0, `version` INTERGER NOT NULL DEFAULT 1, `order` INTERGER NOT NULL DEFAULT 0);CREATE INDEX IF NOT EXISTS `index_order` ON `web_playlist_track` (`order` ASC);"},{name:"web_playlist",createSQL:'DROP TABLE IF EXISTS `web_playlist`;CREATE TABLE IF NOT EXISTS `web_playlist` (`pid` INTERGER NOT NULL, `playlist` TEXT NOT NULL DEFAULT "", PRIMARY KEY (`pid`));'},{name:"web_user_playlist",createSQL:'DROP TABLE IF EXISTS `web_user_playlist`;CREATE TABLE IF NOT EXISTS `web_user_playlist` (`uid` INTERGER NOT NULL, `pids` TEXT NOT NULL DEFAULT "", PRIMARY KEY (`uid`));'},{name:"web_cloud_track",createSQL:'DROP TABLE IF EXISTS `web_cloud_track`; CREATE TABLE IF NOT EXISTS `web_cloud_track` (`uid` INTERGER NOT NULL DEFAULT 0, `id` VARCHAR(40) NOT NULL DEFAULT "", `fileId` VARCHAR(40) NOT NULL DEFAULT "", `file` TEXT NOT NULL DEFAULT "", `fileExt` TEXT NOT NULL DEFAULT "", `size` INTERGER NOT NULL DEFAULT 0, `bitrate` INTERGER NOT NULL DEFAULT 0, `time` INTERGER NOT NULL DEFAULT 0, `name` TEXT NOT NULL DEFAULT "", `album` TEXT NOT NULL DEFAULT "", `artist` TEXT NOT NULL DEFAULT "", `track` TEXT NOT NULL DEFAULT "", `state` INTERGER NOT NULL DEFAULT 0, `version` INTERGER NOT NULL DEFAULT 0, `mst` INTERGER NOT NULL DEFAULT 0, PRIMARY KEY (`uid`, `id`)); CREATE INDEX IF NOT EXISTS `index_name` ON `web_cloud_track` (`name` ASC); CREATE INDEX IF NOT EXISTS `index_album` ON `web_cloud_track` (`album` ASC); CREATE INDEX IF NOT EXISTS `index_artist` ON `web_cloud_track` (`artist` ASC); CREATE INDEX IF NOT EXISTS `index_fileExt` ON `web_cloud_track` (`fileExt` ASC); CREATE INDEX IF NOT EXISTS `index_size` ON `web_cloud_track` (`size` ASC); CREATE INDEX IF NOT EXISTS `index_time` ON `web_cloud_track` (`time` ASC);'}]};this.bVD.bTX("create 20141009 table",function(){var bTR="";byF.tables.forEach(function(bl){bTR+=bl.createSQL});return bTR}())};byx.czJ=function(){this.bJK("tip","开始扫描歌单存储的文件夹");this.bUR.cyH("scan playlist folder 20141009","",!1)};byx.cBd=function(bn){var cAM=[];if(bn&&bn.err==0&&bn.ret&&bn.ret.length){bm.cj(bn.ret,function(bl,bs,AB){if(bl&&bl.type=="file"){if(bl.name=="queue"||bl.name=="history")return;cAM.push(bl.name)}},this)}this.bJK("tip","开始拷贝文件中的数据到数据库");this.cBf=cAM;this.blg=[];this.cAX()};byx.cAX=function(){var cAY=this.cBf.shift();if(cAY){this.blg.push(cAY);this.blf=cAY;this.bUR.bUK("copyfiledata",cAY,0)}else{this.cBg()}};byx.cBc=function(bn){if(bn&&bn.err==0&&bn.ret){this.blf=this.blf||"";if(this.blf.indexOf("playlist_fav-")==0||this.blf.indexOf("playlist_new-")==0){}else if(this.blf.indexOf("track_playlist-")==0){var cP=Number(this.blf.substr(15));if(!!cP){var dJ=bn.ret,An=dJ.tracks,cAZ=[],cBa=[];dJ.trackIds=[];bm.cj(An,function(bB,bs){if(bB){cAZ.push({tid:bB.id,version:bB.version||1,track:bj.ciE(bB)});dJ.trackIds.push({id:bB.id,v:bB.version||1});cBa.push({pid:cP,tid:bB.id,version:bB.version||1,order:bs})}},this);if(cAZ&&cAZ.length){delete dJ.tracks;this.bVD.bTX("copyfiledatatodb",bj.bZR("web_track",cAZ,!0)+bj.bWO("web_playlist",{pid:cP,playlist:bj.ciE(dJ)},!0)+bj.bZR("web_playlist_track",cBa,!0),!0);return}}}this.cAX()}else{this.cAX()}};byx.cBg=function(){this.bJK("tip","开始删除文件数据");if(this.blg&&this.blg.length){bm.cj(this.blg,function(bDj){this.bUR.bgB("deleteCopyedFile","webdata\\file\\"+bDj,!1)},this);this.blg=[]}this.bWl(dK.version,20141009);this.bWl(dK.state,2);this.bXs()};byx.cDW=function(){this.bJK("tip","开始升级上传歌曲表");var bVN=['ALTER TABLE `web_cloud_track` ADD COLUMN `cueFile` TEXT DEFAULT "";',"ALTER TABLE `web_cloud_track` ADD COLUMN `offset` INT DEFAULT 0;","ALTER TABLE `web_cloud_track` ADD COLUMN `duration` INT DEFAULT 0;"];this.bVD.bTX("update 20150115 table web_cloud_track",bVN.join(""))};byx.bJK=function(dS,dU,cE){if(logger){logger.warn(dS+":"+dU,"__notify","updatedata.js")}if(dS=="tip")this.cbX++;this.bF("onnotify",{state:dS,msg:dU,code:cE,progress:(this.cbX||0)/(this.cbW||1)})};byx.bYb=function(){this.bXS()};byx.bYc=function(bu){return JSON.parse(localStorage.getItem(bu))};byx.bUW=function(bu,kf){return JSON.parse(localStorage.getItem(bu))||kf};byx.bUH=function(bu){localStorage.removeItem(bu)};byx.bWl=function(bu,jP){localStorage.setItem(bu,JSON.stringify(jP))};byx.bYz=function(){this.bXD=!0;while(this.bVB&&this.bVB.length){var fj=this.bVB.shift();fj.call(this)}};byx.bYl=function(fj){if(this.bXD){fj.call(this)}else{this.bVB.push(fj);this.bXD=this.hP.bEJ();if(this.bXD){this.bYz()}}};byx.bYd=function(bTY,bg){var bTR="";if(bTY&&bg&&bg.length){bm.cj(bg,function(bl){bTR+=this.bYa(bTY,bl)},this)}return bTR};byx.bYa=function(bTY,fV){var bTR="";if(!!bTY&&!!fV){var bKp="INSERT INTO `"+bTY+"`";var Ni=[];var bUd=[];for(var x in fV){var jP=fV[x];if(jP!=null){Ni.push("`"+x+"`");switch(jP.constructor){case Object:case Array:bUd.push("'"+this.bUC(JSON.stringify(jP))+"'");break;case Boolean:bUd.push(jP?1:0);break;case Date:bUd.push(+jP);break;case Function:console.warn("obj2sql warn: obj has a function property",fV,jP);bUd.push("'"+this.bUC(JSON.stringify(jP))+"'");break;case Number:bUd.push(jP);break;case String:bUd.push("'"+this.bUC(jP)+"'");break;default:console.warn("obj2sql warn: obj has a unknow type property",fV,jP);bUd.push("'"+this.bUC(JSON.stringify(jP))+"'");break}}}if(Ni&&bUd&&Ni.length&&bUd.length){bTR=bKp+" ("+Ni.join(",")+") VALUES ("+bUd.join(",")+");"}}return bTR};byx.bUC=function(){var bLe=/([\'])/g;return function(byX){return(byX||"").replace(bLe,"''")}}()})();
(function(){var byz=NEJ.P,byA=byz("nej.e"),gu=byz("nej.cef"),bm=byz("nej.u"),cI=byz("nej.n"),bj=byz("nm.x"),bp=byz("nm.d"),bi=byz("nej.v"),bD=byz("nm.n");var page={IG:function(){this.HC();this.HV()},HV:function(){gu.uN({width:440,height:211,minWidth:440,minHeight:211,show:!0},"updatedata");this.bWw=bj.bWH.bG({onnotify:this.bXY.byB(this)});this.bWw.mD()},HC:function(){var bg=byA.bV(document.body,"j-flag");this.bdk=bg[0];this.jJ=bg[1];this.bXV=bg[2];bi.bM(bg[3],"click",this.qn.byB(this));bi.bM(byA.cg("clearData"),"click",this.bXZ.byB(this))},bhS:function(){gu.bJo();bj.oA("app.html",{visible:!1});setTimeout(function(){gu.uD()},100)},qn:function(byy){bi.bQd(byy);var hg=this.bXV.checked;if(hg){bj.cL(13,function(cJN){return cJN.bke(this.caf||"","")}.byB(this))}gu.bAA()},bXZ:function(byy){bi.bQd(byy);this.bWw&&this.bWw.bYb()},bXY:function(bn){if(!bn||!bn.state)return;var byx=bn.progress;switch(bn.state){case"tip":byA.bJ(this.jJ.parentNode,"m-dataFail m-updateFail");this.jJ.innerText="正在进行数据升级...";byA.tm(this.bdk,{width:byx*400+"px"});break;case"suc":byA.bJ(this.jJ.parentNode,"m-dataFail m-updateFail");this.jJ.innerText=bn.msg;this.bhS();break;case"warn":byA.bJ(this.jJ.parentNode,"m-updateFail");byA.bK(this.jJ.parentNode,"m-dataFail");break;case"err":var nA=byA.cg("x-id-update-error-code");if(!!nA)nA.innerText=bn.code||0;byA.bJ(this.jJ.parentNode,"m-dataFail");byA.bK(this.jJ.parentNode,"m-updateFail");this.caf=bn.msg;break}}};page.IG()})()</script> </body> </html>