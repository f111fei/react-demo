<meta charset="utf-8"/> <textarea name="txt" id="m-ypup-module"> <div class="g-wrap"> <div class="u-head1"> <h2 class="u-tit f-ff2">编辑歌单信息</h2> </div> <div class="m-form m-form-md"> <div class="fmitm"> <label class="s-fc4">歌单名：</label> <div class="fmcnt"> <input class="u-txt txt j-flag" data-res-menu="true" data-res-type=16 type="text" placeholder="" value="TOP10"> <div class="error j-error s-fc6">该用户名已被占用！</div> </div> </div> <div class="fmitm fmitm-tag"> <label class="s-fc4">标签：</label> <div class="fmcnt"> <span class="tags j-flag"> <span class="u-tag">电影</span> <span class="u-tag">原声带</span> <span class="u-tag">多情</span> </span> <a href="javascript:void(0);" class="f-tdu j-flag">选择标签</a> </div> </div> <div class="fmitm"> <label class="s-fc4">介绍：</label> <div class="fmcnt"> <div class="u-txt u-txt-area area">&lt;textarea data-res-menu="true" data-res-type=16 class="j-flag"&gt;亲，这是要写作文咩？作文嘛~~作文呀！！！&lt;/textarea&gt;<span class="remain s-fc3 j-flag">140</span></div> </div> </div> <div class="fmitm fmitm-btns fmitm-btns-pl"> <label class="s-fc4">&nbsp;</label> <div class="fmcnt"> <button class="u-ibtn1 u-ibtnsz1 z-dis j-flag">保&nbsp;&nbsp;存</button><button class="u-ibtn5 u-ibtnsz1 j-flag">取&nbsp;&nbsp;消</button> </div> </div> <div class="cover"> <div class="cvr u-cover u-cover-edit"> <img class="j-flag" onerror="nm.l.f.empty(this)"> </div> <div class="bar"> <button class="u-ibtn5 u-ibtnw3 j-flag">编辑封面</button> </div> <input type="file" accept="image/*" class="j-flag f-dn"> </div> </div> </div> </textarea> <textarea name="jst" id="m-ypup-tag"> {list tags as t} <span class="u-tag" id="m-ypup-tag">${t|escape}</span> {/list} </textarea> <textarea name="ntp" id="m-ypup-layer"> <div class="lyct lyct-2 m-chtag j-flag"></div> <div class="lybt"> <button type="button" class="u-ibtn1 u-ibtnsz0 j-flag">保存并关闭</button> </div> </textarea> <textarea name="jst" id="m-ypup-cnt"> <h4 class="s-fc4">选择合适的标签，最多可选<strong class="s-fc6">3</strong>个</h4> {if !!cats} {for cat in cats} {if cat.list} <dl class="f-cb"> <dt>${cat.name|escape}</dt> <dd> <ul class="f-cb"> {list cat.list as tag}{var l = cat.list.length-1} <li> <span class="u-tag u-tag-ch f-cp" data-action="select">${tag.name|escape}</span> <span id="${tag.name}" class="icn u-icn u-icn-smlslt"><svg><use xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#selected_sml"></use></svg></span> </li> {/list} </ul> </dd> </dl> {/if} {/for} {else} <div class="m-empty m-empty-4"> <p class="s-fc4">获取标签失败，稍后再试</p> </div> {/if} </textarea> <textarea name="js">(function(){var byz=NEJ.P,byA=byz("nej.e"),bi=byz("nej.v"),bm=byz("nej.u"),bp=byz("nm.d"),bj=byz("nm.x"),bR=byz("nm.l"),bzc=3,byx,byD,bwm;bR.Ny=NEJ.C();byx=bR.Ny.bS(bR.ir);byD=bR.Ny.gZ;byx.byR=function(){this.bEc()};byx.eo=function(){this.Yl="m-ypup-layer"};byx.byL=function(){this.byO();var bg=byA.bV(this.bA,"j-flag");this.iJ=bg[0];this.cnG=bg[1];bi.bM(this.iJ,"click",this.bba.byB(this));bi.bM(this.cnG,"click",this.wS.byB(this));this.byJ={onlistload:this.btA.byB(this),onlisterror:this.btB.byB(this),onerror:bj.jD.byP(bj,true,this.iJ)}};byx.cJ=function(blZ){this.cK(blZ);this.kZ=[];this.sV=0;this.bM("commit",blZ.oncommit);NEJ.X(this.kZ,blZ.tags);this.dX=blZ.pid||"";if(!this.bH)this.bH=bp.mo.bG(this.byJ)};byx.dH=function(){this.dI();bi.nh(this.iJ,"click",this.bba.byB(this));bi.nh(this.cnG,"click",this.wS.byB(this));delete this.kZ};byx.dD=function(bo){this.fP="frgmt_tags_playlist-"+this.dX;this.bH.fE({offset:0,limit:1e3,key:this.fP});byD.dD.apply(this,arguments)};byx.btA=function(bn){this.btD=this.bH.byI("frgmt_tags_playlist-"+this.dX);byA.eB(this.iJ,"m-ypup-cnt",{cats:this.btD});this.btE()};byx.btB=function(bn){byA.eB(this.iJ,"m-ypup-cnt",{cats:null})};byx.btE=function(){if(!!this.kZ){bm.cj(this.kZ,function(kF){var bk=byA.cg(kF);this.sV++;byA.bK(bk,"z-slt")},this)}};byx.bba=function(byy){var bv=bi.cR(byy,"d:action");if(!bv)return;if(byA.bT(bv,"action")!="select")return;var bk=bv.nextElementSibling,cH=byA.ey(bk,"z-slt");if(!cH){if(this.sV>=bzc)return;this.sV++;byA.bK(bk,"z-slt")}else{this.sV--;byA.bJ(bk,"z-slt")}};byx.wS=function(){this.kZ=[];var bg=byA.bV(this.bA,"z-slt");if(bg.length>3)return;bm.cj(bg,function(bl){this.kZ.push(bl.id)}.byB(this));this.bF("commit",this.kZ);this.dy()};byx.xt=function(){this.wS()}})();
(function(){var byz=NEJ.P,co=NEJ.F,byA=byz("nej.e"),bi=byz("nej.v"),bm=byz("nej.u"),bj=byz("nm.x"),bp=byz("nm.d"),bR=byz("nm.l"),bY=byz("nm.m"),bC=byz("nm.m.y"),sB=40,bzc=1e3,byx;bC.bbb=NEJ.C();byx=bC.bbb.bS(bY.cW);byx.byG=function(){this.bCU="m-ypup";this.dg();var mF=byA.bV(this.bA,"j-flag");this.oG=mF[0];this.bbc=mF[1];this.btI=mF[2];this.qf=mF[3];this.btK=mF[4];this.bAz=mF[5];this.btM=mF[6];this.xN=mF[7];this.gh=byA.bV(this.bA,"j-error")[0];this.byJ={onitemload:this.uy.byB(this),onitemupdate:this.btN.byB(this),oncoverupdate:this.btO.byB(this),onerror:this.gF.byB(this)};bi.bM(this.oG,"input",this.vF.byB(this));bi.bM(this.qf,"input",this.vF.byB(this));bi.bM(this.btI,"click",this.btP.byB(this));bi.bM(this.bAz,"click",this.wS.byB(this));bi.bM(this.btM,"click",this.vs.byB(this));bi.bM(this.qf,"input",this.LU.byB(this));bi.bM(this.qf,"blur",this.vF.byB(this));bi.bM(this.qf,"blur",this.LU.byB(this));bi.bM(mF[8],"click",this.Ho.byB(this,mF[9]));bi.bM(mF[9],"change",this.wR.byB(this))};byx.byT=function(blZ){if(!this.bH)this.bH=bp.dZ.bG(this.byJ);this.cmx(blZ)};byx.dq=function(blZ){this.rQ();var bP=blZ.param||cJO,bZ=bP.uid||localCache.cF("host.profile.userId");this.dX=bP.id;this.fP="playlist-"+bZ;this.bH.hv({id:this.dX,key:this.fP});this.dC(blZ)};byx.dm=function(dN){byA.bJ(this.gh,"f-dn");this.gh.innerText=dN};byx.rQ=function(){byA.bK(this.gh,"f-dn");this.gh.innerText=""};byx.vF=function(){var LR=this.oG.value.trim();if(bm.rV(LR)>sB){var bs;for(bs=sB;bm.rV(LR.slice(0,bs))>sB;bs--){}this.oG.value=LR.slice(0,bs)}this.LU();if(this.oG.value.search(/@|#/)>-1){this.dm("歌单名不能包含@或#");byA.bK(this.bAz,"z-dis");return}else{this.rQ()}if(this.oG.value==""){this.dm("歌单名不能为空");byA.bK(this.bAz,"z-dis");return}else if(!this.oG.value.trim()){this.dm("给歌单取个名字吧，全空白不算哦");byA.bK(this.bAz,"z-dis");return}else{this.rQ()}this.Fi=true;if(!this.kZ)return;if(this.oG.value!=this.bbd)this.Fi=false;if(this.qf.value!=this.bbe)this.Fi=false;if(this.kZ.join()!=this.bbf.join())this.Fi=false;if(this.Fi)byA.bK(this.bAz,"z-dis");else byA.bJ(this.bAz,"z-dis")};byx.uy=function(bn){this.es=this.bH.cl(this.dX);this.xN.src=(this.es.coverImgUrl||bj.hk().artist)+"?param=180y180&quality=100";this.bbd=this.oG.value=this.es.name;this.bbe=this.qf.value=this.es.description||"";this.bW={};this.kZ=this.es.tags||[];this.bbf=this.kZ.concat();this.bbg(this.es.tags);this.eZ={destroyable:!0,mask:!0,draggable:!0,parent:document.body,clazz:"m-layer-tag z-show",title:"选择标签",pid:this.dX,oncommit:this.btX.byB(this)};this.btY={type:"album",parent:document.body,clazz:"m-layer-edt z-show",title:"编辑歌单封面",draggable:true,onok:this.Pl.byB(this),onclose:this.uO.byB(this)};this.LU();var dJ=this.es;if(!bj.btm()&&!dJ.nocreator&&(!dJ.creator||dJ.creator.userId!=localCache.cF("host.profile.userId")&&!dJ.creator.nickname)){dispatcher.dr("/m/disc/rec/",{replace:!0,force:!0});history.clearBack()}};byx.Ho=function(bk,byy){bi.bF(bk,"click")};byx.LU=function(byy){var byX=this.qf.value;var dx=byX.length;this.btK.innerText=bzc-dx;if(dx>bzc){byA.bK(this.btK,"z-over")}else{byA.bJ(this.btK,"z-over")}};byx.wR=function(byy){this.uO();this.pS=bR.Li.bG(this.btY);this.pS.RA(byy);this.pS.dD();bi.cR(byy).value=""};byx.Pl=function(btZ){if(!this.bH.cWs(this.dX)){bj.ci({state:"loading"});this.bH.bwc({id:this.dX,data:btZ,html5:true})}};byx.btO=function(bh){if(!bh.code){this.xN.src=bh.coverImgUrl+"?param=180y180&quality=100";bj.ci({state:"success",delay:1,duration:1});this.uO()}else{}};byx.uO=function(){!!this.pS&&this.pS.bQ()};byx.btP=function(){if(!this.eZ)return;this.eZ.tags=this.kZ;bR.Ny.bG(this.eZ).dD()};byx.btX=function(lu){this.kZ=lu;this.bbg(lu)};byx.bbg=function(lu){this.bbc.innerHTML="";if(lu.length>0){byA.eB(this.bbc,"m-ypup-tag",{tags:lu})}this.vF()};byx.wS=function(){if(!this.bH.cWs(this.dX)){if(byA.ey(this.btK,"z-over")){bj.ci({txt:"介绍字数超限"});return}bj.ci({state:"loading"});var bh={tags:this.kZ.join(";"),description:this.qf.value,name:this.oG.value.trim().replace(/\s+/g," "),id:this.dX};this.bH.Nt({data:bh,key:"playlist_new-"+localCache.cF("host.profile.userId")})}};byx.btN=function(byy){if(!!byy.ext){this.bua();setTimeout(function(){this.vs()}.byB(this),100)}else{}};byx.bua=function(){this.bbd=this.oG.value;this.bbe=this.qf.value;this.bbf=this.kZ.concat();this.vF()};byx.vs=function(){location.href="#/m/playlist/?id="+this.dX};byx.gF=function(byy){if(bj.hi(byy)){bj.ci({txt:"网络不给力哦，请检查你的网络设置~"});byy.stopped=true}};bj.cU("/m/playlistedit/",bC.bbb)})()</textarea>