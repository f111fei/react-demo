<meta charset="utf-8"/> <textarea name="txt" id="m-rivt-module"> <div class="g-wrap g-bd n-invite"> <div class="u-head1"> <h2 class="u-tit f-ff2">寻找并邀请好友</h2> </div> <div class="cnt j-flag"></div> </div> </textarea> <textarea name="jst" id="m-rivt-empty"> <div class="notbind"> <h3 class="f-ff2">{if valid}未绑定帐号{else}授权已失效{/if}</h3> <p class="s-fc3">{if valid}绑定{/if}{if type==2}新浪微博{/if}{if !valid}重新授权{/if}，发现更多好友！</p> <button data-action="bind" data-type="${type}" data-from="{if valid}bind{else}accredit{/if}" class="u-ibtn5 u-ibtn5-bind u-ibtnst1 u-ibtnw2">{if valid}立即绑定{else}重新授权{/if} <i class="arr f-ff1 s-fc3 f-fwb">&gt;</i></button> </div> </textarea> <textarea name="ntp" id="m-rivt-subtab"> <div class="subtab"> <a href="javascript:void(0);" data-action="subtab" data-tab="0" class="j-flag">已有<span>0</span>位好友加入</a> <span class="line s-wbd0">|</span> <a href="javascript:void(0);" data-action="subtab" data-tab="1" class="j-flag">邀请另外<span>0</span>位好友加入</a> </div> <div class="j-flag"></div> <h3 class="j-flag f-dn title s-fc3">选择你想邀请的好友：</h3> <ul class="j-flag frdlist f-cb"><div class="u-load"></div></ul> </textarea> <textarea name="jst" id="m-rivt-follow-list"> {list beg..end as y} {var x=xlist[y]} <li> <div class="head"> <a href="#/m/personal/?uid=${x.userId}" class="u-face u-face-5"> <div class="wrap">${commonJST('com-img', x.avatarUrl, '60y60')}</div>${commonJST('com-user-type-2', x, 'flag')} </a> </div> <p class="f-thide"> <a href="#/m/personal/?uid=${x.userId}" class="s-fc3">${x.nickname}</a>${commonJST('com-user-vip', x)} </p> {if x.followed}<button class="u-ibtn5 u-ibtn5-followed" data-action="follow" data-uid="${x.userId}"><svg><use xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#btn_added"></use></svg>已关注</button>{else}<button class="u-ibtn5 u-ibtn5-follow" data-action="follow" data-uid="${x.userId}"><svg><use xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#btn_add"></use></svg>关 注</button>{/if} </li> {/list} </textarea> <textarea name="jst" id="m-rivt-invite-list"> {list beg..end as y} {var x=xlist[y]} <li> <div class="head" data-action="invite" data-uid="${x.userId}" data-nick="${x.nickname}" data-atname="${x.atname}"> <span class="u-face u-face-5"> <div class="wrap">${commonJST('com-img', x.avatarUrl)}</div> </span> <i class="slted"><svg><use xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#invite_selected"></use></svg></i> </div> <p class="f-thide s-fc3">${x.nickname}</p> </li> {/list} </textarea> <textarea name="js">(function(){var byz=NEJ.P,cJO=NEJ.O,byA=byz("nej.e"),cN=byz("nej.j"),bm=byz("nej.u"),bi=byz("nej.v"),bU=byz("nej.ut"),bj=byz("nm.x"),bxI=byz("nm.i"),bR=byz("nm.l"),bp=byz("nm.d"),bY=byz("nm.m"),bC=byz("nm.m.r"),bTG=byz("nm.c"),byx,byD;bC.Zp=NEJ.C();byx=bC.Zp.bS(bY.cW);byx.byG=function(){this.bCU="m-rivt";this.dg();var bg=byA.bV(this.bA,"j-flag");this.iJ=bg[0];bi.bM(this.iJ,"click",this.ei.byB(this));bi.bM(bTG.bFY,"bind",this.cBx.byB(this));this.byJ={onfollowupdate:this.Lh.byB(this),onlistload:this.Oo.byB(this),onsnsfriendload:this.bpR.byB(this),onerror:bj.jD.byP(this,true,this.iJ)};this.bAT={onshare:this.Ij.byB(this),onerror:bj.jD.byP(this,true,this.iJ)}};byx.eR=function(){byA.bJ(this.bA.parentNode,"z-noscr");this.byU();if(this.pF)delete this.pF;if(this.bBQ)delete this.bBQ;if(this.cZ)delete this.cZ;if(this.yL)delete this.yL;if(this.hD)delete this.hD;if(this.bmF)delete this.bmF;this.iJ.innerHTML=""};byx.cJ=function(blZ){this.cK(blZ);if(this.pF)delete this.pF;if(this.bBQ)delete this.bBQ;if(this.cZ)delete this.cZ;if(this.yL)delete this.yL;if(this.hD)delete this.hD;if(this.bmF)delete this.bmF;this.iJ.innerHTML=""};byx.dq=function(blZ){byA.bK(this.bA.parentNode,"z-noscr");this.dC(blZ);var bP=blZ.param||cJO,dM=blZ.input||cJO,bs=bP.type||dM.type,AK=bP.force||dM.force||false;if(!!AK)delete this.cZ;if(!!bs)this.yL=parseInt(bs);if(!!this.bH)this.bH.bQ();this.bH=bp.du.bG(this.byJ);if(!!this.fW)this.fW.bQ();this.fW=bp.mo.bG(this.bAT);this.dn=localCache.cF("host.profile.userId");this.fP="user_bindings-"+this.dn;this.iJ.innerHTML='<div class="u-load"></div>';this.bH.tw(this.fP,!1);this.bH.fE({key:this.fP,offset:0,limit:10,data:{offset:0,limit:10,userId:this.dn}})};byx.Oo=function(blZ){if(blZ.key!=this.fP)return;var CF=this.bH.byI(this.fP);this.pF=new Array(7);for(var i=0,qW;qW=CF[i];i++){var eQ=JSON.parse(qW.tokenJsonStr);switch(qW.type){case 2:this.pF[2]={type:2,uid:eQ.uid,token:eQ};break}}var bs=this.cZ||this.yL||(this.pF[2]||!this.pF[6]?2:6);this.BC(bs)};byx.BC=function(bs,byy){if(this.cZ==bs)return;this.cZ=bs;this.bpX()};byx.bpY=function(){var oY=!0,byE={2:0,3:3,4:2,6:1,8:4},gG=bj.cL(11,function(cJN){return(cJN.hw()||{}).bindAccount});if(gG&&gG[byE[this.cZ]]&&gG[byE[this.cZ]].bind){oY=gG[byE[this.cZ]].update}return oY};byx.bpX=function(){var iR=this.pF[this.cZ];var oY=this.bpY();this.iJ.innerHTML="";if(!!iR&&oY){var bk=byA.Vx("m-rivt-subtab");this.lB=byA.bV(bk,"j-flag");byA.bK(this.lB[2],"f-dn");byA.bK(this.lB[3],"f-dn");if(!!this.ck)this.ck.bQ();this.ck=bj.bzS.bG({editorClazz:"m-editor m-editor-invite",parent:this.lB[2],remain:true,btnText:"发送邀请",hideAt:true,hideHash:true,showAtDelete:true,hideEmot:true,maxLen:120,onreply:this.bqb.byB(this),onatchange:this.Zu.byB(this,false),onexceedmax:this.Zu.byB(this,true)});this.ck.OQ("邀请你使用网易云音乐。");this.iJ.appendChild(bk);this.bH.eN("user_sns_in_music-"+this.cZ);this.bH.eN("user_sns_no_music-"+this.cZ);this.bH.bot(this.cZ,true)}else{byA.eB(this.iJ,"m-rivt-empty",{type:this.cZ,valid:oY})}};byx.ei=function(byy){var bk=bi.cR(byy,"d:action");if(!bk)return;bi.bQd(byy);switch(byA.bT(bk,"action")){case"bind":bj.oA("sns.html",{snsType:parseInt(byA.bT(bk,"type")),callbackType:"Binding",from:byA.bT(bk,"from"),visible:!1});break;case"subtab":if(byA.ey(bk,"z-sel"))return;if(this.hD)delete this.hD;if(this.bmF)delete this.bmF;switch(parseInt(byA.bT(bk,"tab"))){case 0:byA.bJ(this.lB[1],"z-sel");byA.bK(this.lB[0],"z-sel");this.Zv(0);break;case 1:byA.bJ(this.lB[0],"z-sel");byA.bK(this.lB[1],"z-sel");this.Zv(1);break}break;case"follow":if(!this.bmF)this.bmF={};var bZ=byA.bT(bk,"uid");if(!!this.bmF[bZ])return;if(byA.ey(bk,"u-ibtn5-follow")){this.bmF[bZ]={followed:true,node:bk}}else{this.bmF[bZ]={followed:false,node:bk}}this.bH.wE(bZ,this.bmF[bZ].followed);break;case"invite":if(!this.hD)this.hD={};var bZ=byA.bT(bk,"uid");var bqe=this.bA.scrollTop;if(!!this.hD[bZ]){byA.bJ(bk,"z-slt");this.ck.bms(this.hD[bZ].atname);delete this.hD[bZ]}else{byA.bK(bk,"z-slt");var Zw="@"+byA.bT(bk,"atname")+" ";this.hD[bZ]={uid:bZ,atname:Zw,node:bk};this.ck.bnI(Zw)}this.bA.scrollTop=bqe;break}};byx.cBx=function(bn){if(!this.cZ)return;var bq=this.cZ;delete this.cZ;dispatcher.hM("/m/friend/find/invite/?type="+bq)};byx.Lh=function(bn){if(!!bn.userId){var bZ=bn.userId+"";if(this.bmF[bZ]){if(this.bmF[bZ].followed){byA.bEq(this.bmF[bZ].node,"u-ibtn5-follow","u-ibtn5-followed");this.bmF[bZ].node.innerHTML='<svg><use xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#btn_added"></use></svg>已关注'}else{byA.bEq(this.bmF[bZ].node,"u-ibtn5-followed","u-ibtn5-follow");this.bmF[bZ].node.innerHTML='<svg><use xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#btn_add"></use></svg>关 注'}delete this.bmF[bZ]}}};byx.bpR=function(bn){this.lB[0].firstElementChild.textContent=bn.in_total;this.lB[1].firstElementChild.textContent=bn.no_total;bi.bF(this.lB[0],"click")};byx.Zv=function(bq){if(this.cw)this.cw.bQ();switch(bq){case 0:byA.bK(this.lB[2],"f-dn");byA.bK(this.lB[3],"f-dn");this.cw=bU.jN.bG({parent:this.lB[4],limit:1e4,item:{klass:"m-rivt-follow-list",commonJST:ctl.commonJST.cFB},cache:{lkey:"user_sns_in_music-"+this.cZ,klass:bp.du},onemptylist:this.bAe.byB(this,"还没有加入云音乐的好友，赶紧去邀请吧"),onafterlistload:this.bzK.byB(this),onbeforelistload:this.im.byB(this,"m-xwgt-white-list-loading"),onafterpullrefresh:this.og.byB(this),onbeforepullrefresh:this.im.byB(this,"m-xwgt-white-list-loading"),onbeforelistclear:this.bzb.byB(this)});break;case 1:byA.bJ(this.lB[2],"f-dn");byA.bJ(this.lB[3],"f-dn");this.cw=bU.jN.bG({parent:this.lB[4],limit:1e4,item:{klass:"m-rivt-invite-list",commonJST:ctl.commonJST.cFB},cache:{lkey:"user_sns_no_music-"+this.cZ,klass:bp.du},onemptylist:this.bAe.byB(this,"所有的好友都陪你在玩云音乐，真棒"),onafterlistload:this.bzK.byB(this),onbeforelistload:this.im.byB(this,"m-xwgt-white-list-loading"),onafterpullrefresh:this.og.byB(this),onbeforepullrefresh:this.im.byB(this,"m-xwgt-white-list-loading"),onbeforelistclear:this.bzb.byB(this)});break}};byx.Zu=function(mB,cv){if(!!this.hD&&!!cv){if(!(cv.charAt(cv.length-1)===" "))cv=cv+" ";for(var x in this.hD){if(this.hD.hasOwnProperty(x)){if(this.hD[x].atname==cv){byA.bJ(this.hD[x].node,"z-slt");delete this.hD[x];if(mB){bj.ci({txt:"再@就超过字数限制了"})}break}}}}};byx.bqb=function(bn){if(navigator.offline){bj.ci({txt:"无法邀请，网络不给力哦，请检查你的网络设置~"});return}this.ck.xk({btnText:"正在发送中",btnClazz:"z-dis"});var bh={sns:[this.cZ]};bh[this.cZ]={content:bn.content+"http://music.163.com"};this.fW.Qf(bh)};byx.Ij=function(bn){var bzg=bn[this.cZ];if(bzg!==undefined){this.ck.rJ({btnText:"发送邀请",btnClazz:"z-dis"});if(bzg==1){bj.ci({txt:"成功分享至微博",state:"success"});this.ck.OQ("邀请你使用网易云音乐。");if(this.hD){for(var x in this.hD){if(this.hD.hasOwnProperty(x)){byA.bJ(this.hD[x].node,"z-slt");delete this.hD[x]}}delete this.hD}}else{bj.ci({txt:"分享到微博失败"})}}};bj.cU("/m/friend/find/invite/",bC.Zp)})()</textarea>