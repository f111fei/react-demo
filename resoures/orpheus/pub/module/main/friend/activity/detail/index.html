<meta charset="utf-8"/> <textarea name="txt" id="m-revt-activity-module"> <div class="g-bd"> <div class="g-bdm"> <div class="g-bdmc f-pr"> <div class="j-flag m-actfix"> <div class="inner"> <div class="btns"> <button data-action="refresh" class="u-ibtn5 u-ibtn-reflash f-fr"><svg class="f-pr"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#btn_reflash"></use></svg></button> <button data-action="share" href="javascript:;" class="u-ibtn5 f-fr"><svg class="f-pr"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#btn_share"></use></svg>分享</button> <button data-action="participate" href="javascript:;" class="u-ibtn5 u-ibtn5-redword f-fr"><svg class="f-pr"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#btn_write"></use></svg>立即参与</button> </div> </div> <div class="u-msg j-flag">有新动态，<a href="javascript:;" data-action="refresh" class="f-tdu s-fc1">点击查看</a></div> </div> <div class="g-wrap q-lrc"> <div style="padding-top:1px;"><div class="u-load">载入中...</div></div> <div class="m-timeline"> <div class="m-timeact m-dlist j-flag"></div> <div class="u-msg j-flag">有新动态，<a href="javascript:;" data-action="refresh" class="f-tdu s-fc1">点击查看</a></div> <h2 class="smlhead s-fc3 f-dn j-flag">热门动态</h2> <ul class="m-dlist f-dn j-flag"></ul> <h2 class="smlhead s-fc3">所有动态</h2> <ul class="m-dlist j-flag"></ul> <div class="j-flag"></div> </div> </div> <div class="j-flag"></div> </div> </div> <div class="g-bds f-pr"> <div class="n-topic n-topic-fix j-flag"></div><!--推荐话题--> </div> </div> </textarea> <textarea name="jst" id="m-revt-activity-info"> <div class="activity activity-detail f-pr f-cd" style="background-image:url(${coverPCLongUrl});"> ${commonJST('com-img', coverPCUrl, '526y218', 'pic')} <article class="title s-fc8 f-ff2 f-pr"> <div class="inner"> <h3 class="f-pr j-flag">${title}<span class="number f-pa"><em>${participateCount}人参与</em></span></h3> <div class="btnwrap"><a data-action="participate" href="javascript:;" class="btn f-ff2 f-fs1"><svg class="f-pr"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#btn_write"></use></svg>立即参与</a></div> </div> </article> <a data-action="share" href="javascript:;" class="share f-pa"><svg class="f-pr"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#topic_share"></use></svg></a> </div> <ul class="cnt f-fs1 s-fc3"> {list text as t} <li>${t}</li> {/if} </ul> </textarea> <textarea name="js">(function(){var byz=NEJ.P,cJO=NEJ.O,byA=byz("nej.e"),bi=byz("nej.v"),bm=byz("nej.u"),cN=byz("nej.j"),bU=byz("nej.ut"),cmw=byz("nej.ui"),bj=byz("nm.x"),bxI=byz("nm.i"),bp=byz("nm.d"),bR=byz("nm.l"),bC=byz("nm.m.c"),byx,byD;var dbn="/?/share/other/";bR.dbo=NEJ.C();byx=bR.dbo.bS(bR.ir);byD=bR.dbo.gZ;byx.cJ=function(blZ){blZ.clazz="m-layer m-layer-share m-layer-auto";blZ.title="分享";this.cK(blZ);dispatcher.dr(dbn,{input:{parent:this.QF,rid:blZ.rid,type:blZ.type}})};byx.eo=function(){this.Yl="m-xwgt-share-out"};byx.byL=function(){this.byO();var bg=byA.bV(this.bA,"j-flag");this.QF=bg.shift()};byx.dD=function(){byD.dD.apply(this,arguments);bj.gM(dbn,{cmd:"aftershow"})};byx.dy=function(){bj.gM(dbn,{cmd:"onhide"});byD.dy.apply(this);this.bQ()}})();
(function(){var byz=NEJ.P,cJO=NEJ.O,byA=byz("nej.e"),bi=byz("nej.v"),bm=byz("nej.u"),bD=byz("nej.n"),bU=byz("nej.ut"),fH=byz("nej.cef"),cN=byz("nej.j"),bj=byz("nm.x"),bxI=byz("nm.i"),bR=byz("nm.l"),bp=byz("nm.d"),bY=byz("nm.m"),gD=byz("nm.w"),bC=byz("nm.m.r"),bTG=byz("nm.c"),byx,byD;var dez=2e4;bC.cOc=NEJ.C();byx=bC.cOc.bS(bY.cW);byx.byG=function(){this.bCU="m-revt-activity";this.dg();var bg=byA.bV(this.bA,"j-flag");this.dbm=bg.shift();this.dbp=bg.shift();this.Jy=bg.shift();this.vp=bg.shift();this.cOd=bg.shift();this.cMY=bg.shift();this.deA=bg.shift();this.deB=bg.shift();this.chD=bg.shift();this.dbI=bg.shift();this.bMO=this.Jy.parentNode;this.caD=this.bMO.previousElementSibling;this.ip={rcmd:this.dbI};this.bL={limit:20,delta:30,sbody:null,parent:this.deA,item:{key:"id",klass:bxI.Sh,place:"activity"},pager:{parent:this.deB,clazz:"m-page m-page-wt"},cache:{klass:bp.kj,clear:true},onemptylist:this.bAe.byB(this,"暂无动态"),onbeforelistload:this.tH.byB(this),onpagechange:this.bzC.byB(this)}};byx.byT=function(blZ){this.cmx(blZ);this.dO([[this.bA,"click",this.btw.byB(this)],[this.bA,"scroll",this.dcE.byB(this)],[location,"beforeurlchange",this.gv.byB(this)],[bTG.cvI,"publish_task_state_change",this.cOM.byB(this)]]);this.deC()};byx.eR=function(){this.byU(!0);this.RO();this.ddX()};byx.cxQ=function(){this.eV=0;this.bUP();this.RO();this.bdG()};byx.bUP=function(){if(this.cPV&&this.cPV.length){bxI.Sh.bQ(this.cPV)}delete this.cPV};byx.ddW=function(dcQ){this.bUP();cN.bzs(APP_CONF.domain+"/api/act/event/hot",{type:"json",query:{actid:dcQ},onload:this.cPj.byB(this)})};byx.dq=function(blZ){this.dC(blZ);var bP=blZ.param||cJO,cJN=bP.cache;if(cJN&&this.eV){this.bA.scrollTop=this.eV;return}if(this.cw){this.cw=this.cw.bQ();this.cw=null}if(this.cQz)this.cQz.bQ();this.cQz=bp.cTb.bG({onactivitytitle:this.ddp.byB(this),onactivitytitleerror:this.ddo.byB(this),onactivitynew:this.deD.byB(this,blZ.param.id)});if(this.dgo)this.dgo.bQ();this.dgo=bp.kj.bG();byA.bJ(this.dbm,"z-show");byA.bK(this.bMO,"f-dn");byA.bK(this.chD,"f-dn");byA.bK(this.cOd,"f-dn");byA.bK(this.cMY,"f-dn");byA.bJ(this.caD,"f-dn");this.GQ(blZ.param.id);nm.log.cFs("page",{type:"eventactivity",id:blZ.param.id})};byx.GQ=function(dcQ){cN.bzs(APP_CONF.domain+"/api/act/detail",{type:"json",query:{actid:dcQ},onload:this.cOe.byB(this),onerror:this.cOe.byB(this)});this.ddW(dcQ);if(this.cw){this.cw.rY().eN("event_activity-"+dcQ);this.cw.hM()}else{this.bL.cache.lkey="event_activity-"+dcQ;this.bL.cache.data={actid:dcQ};this.bL.sbody=byA.bV(document.body,"g-bd")[0];this.cw=bU.jN.bG(this.bL)}this.ddU(+(new Date));this.ddT(false);this.deE()};byx.tH=function(byy){var ep=byy.parent.children.length==0?"m-xwgt-white-loading":"m-xwgt-white-list-loading";byy.value=byA.gy(ep)};byx.bzC=function(){if(this.bL.sbody)this.bL.sbody.scrollTop=0};byx.cOe=function(byy){byA.bK(this.caD,"f-dn");var cE=byy.code;if(cE==200){byA.bJ(this.bMO,"f-dn");this.pm=byy.act;byA.eB(this.Jy,"m-revt-activity-info",NEJ.X({commonJST:ctl.commonJST.cFB},this.pm));bj.dgD({textNode:byA.bV(this.Jy,"j-flag")[0].firstChild,prefix:"#",suffix:"#"});this.ddV={offset:byA.lp(this.Jy),height:this.Jy.offsetHeight}}else if(cE==404){bj.sC();byy.stopped=true}else{byA.bK(this.bMO,"f-dn");byA.bJ(this.chD,"f-dn");this.ej(this,true,this.chD,"",{isPage:true})}};byx.btw=function(byy){var bk=bi.cR(byy,"d:action");if(!bk)return;var cX=byA.bT(bk,"action");switch(cX){case"participate":if(bj.btm()){bj.bNt();break}if(this.cKz)this.cKz.bQ();this.cKz=bR.cKq.bG({destroyable:true,text:"#"+this.pm.title+"# ",actId:this.pm.actId,actName:this.pm.title,resourceType:this.pm.resourceType,resourceJson:this.pm.resourceJson||this.pm.resoruceJson}).dD();nm.log.bTO("f1171");bi.bQd(byy);break;case"share":bR.dbo.bG({rid:this.pm.actId,type:"eventactivity"}).dD();nm.log.bTO("f1172");bi.bQd(byy);break;case"refresh":this.GQ(this.pm.actId);bi.bQd(byy);break;case"activity":var oS=byA.bT(bk,"title");oS=/^#(.+?)#$/.exec(oS)[1];if(this.pm.title!=oS){this.cQz.ddF(oS)}bi.bQd(byy);break}};byx.cPj=function(byy){if(byy.code==200&&byy.events.length){this.dgo.hI("event_activity_hot",byy.events);this.cPV=byA.DP(byy.events,bxI.Sh,{parent:this.cMY,place:"activity"});byA.bJ(this.cOd,"f-dn");byA.bJ(this.cMY,"f-dn")}};byx.cOM=function(byy){if(byy.task.state==3){this.pm.participateCount=Math.max(this.pm.participateCount,0)+1;byA.eB(this.Jy,"m-revt-activity-info",NEJ.X({commonJST:ctl.commonJST.cFB},this.pm));bj.ci({state:"success",txt:"分享成功"})}};byx.dcE=function(){if(this.bA.scrollTop>this.ddV.offset.y+this.ddV.height){byA.byW(this.dbm,"top",this.bA.scrollTop+"px");byA.bK(this.dbm,"z-show");this.ddS(true)}else{byA.byW(this.dbm,"top",0);byA.bJ(this.dbm,"z-show");this.ddS(false)}this.ddR()};byx.ddp=function(cRq){if(cRq.act){location.href="#/m/friend/activity?id="+cRq.act.actId}else{bj.ci({txt:"该话题暂未创建"})}};byx.ddo=function(){bj.ci({txt:"该话题暂未创建"})};byx.deD=function(dcQ,cRq){if(cRq.new&&dcQ==this.pm.actId){this.ddT(true)}else{this.ddT(false)}this.ddR()};byx.ddR=function(){if(!this.deF())return;if(this.deG()){byA.bK(this.dbp,"z-show");byA.bJ(this.vp,"z-show")}else{byA.bK(this.vp,"z-show");byA.bJ(this.dbp,"z-show")}};byx.deE=function(){byA.bJ(this.dbp,"z-show");byA.bJ(this.vp,"z-show")};byx.deC=function(){this.ddU(+(new Date));this.ddX();this.ddQ=setInterval(function(){this.cQz.dex(this.pm.actId,this.deH())}.byB(this),dez)};byx.ddX=function(){this.ddQ=clearInterval(this.ddQ)};byx.ddU=function(deI){this.deJ=deI};byx.deH=function(){return this.deJ};byx.ddS=function(deK){this.deL=!!deK};byx.deG=function(){return!!this.deL};byx.ddT=function(deM){this.deN=!!deM};byx.deF=function(){return!!this.deN};byx.hA=function(byy){if(!byy||!byy.data||!byy.data.cmd)return;switch(byy.data.cmd){case"clear":this.cxQ();break}};byx.gv=function(byy){if(!!byy&&!!byy.oldValue&&byy.oldValue.path==this.gq){this.eV=this.bA.scrollTop}};bj.cU("/m/friend/activity",bC.cOc)})()</textarea>