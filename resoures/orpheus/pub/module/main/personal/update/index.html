<meta charset="utf-8"/> <textarea name="txt" id="m-pupd-module"> <div class="g-wrap"> <div class="u-head1"> <h2 class="u-tit f-ff2">编辑个人信息</h2> </div> <div class="m-form"> <div class="fmitm"> <label class="s-fc4">昵称：</label> <div class="fmcnt"> <input data-res-menu="true" data-res-type=16 class='j-flag u-txt txt' type="text" value=""> <div class="j-flag error s-fc6"></div> </div> </div> <div class="fmitm"> <label class="s-fc4">介绍：</label> <div class="fmcnt"> <div class="u-txt u-txt-area area j-flag"> <textarea data-res-menu="true" data-res-type=16><&#47;textarea> <span class="remain s-fc3">140</span> </div> </div> </div> <div class="fmitm"> <label class="s-fc4">性别：</label> <div class="fmcnt"> <ul class="u-cklist u-cklist-auto j-flag"> <li><label class="s-fc4"><input type="radio" name="sex"><span><svg><use xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#radio"></use></svg></span>保密</label></li> <li><label class="s-fc4"><input type="radio" name="sex"><span><svg><use xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#radio"></use></svg></span>男</label></li> <li><label class="s-fc4"><input type="radio" name="sex"><span><svg><use xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#radio"></use></svg></span>女</label></li> </ul> </div> </div> <div class="fmitm fmitm-fete"> <label class="s-fc4">生日：</label> <div class="fmcnt j-flag"> <div class="u-select"> <div class="value value-none"></div> <div class="sltwrap"><div class="select"></div></div> </div> <div class="u-select"> <div class="value value-none"></div> <div class="sltwrap"><div class="select"></div></div> </div> <div class="u-select"> <div class="value value-none"></div> <div class="sltwrap"><div class="select"></div></div> </div> </div> </div> <div class="fmitm fmitm-city"> <label class="s-fc4">省市：</label> <div class="fmcnt j-flag"> <div class="u-select"> <div class="value value-none"></div> <div class="sltwrap"><div class="select"></div></div> </div> <div class="u-select"> <div class="value value-none"></div> <div class="sltwrap"><div class="select"></div></div> </div> </div> </div> <div class="fmitm fmitm-btns"> <label class="s-fc4">&nbsp;</label> <div class="fmcnt j-flag"> <button class="u-ibtn1 u-ibtnsz1">保&nbsp;&nbsp;存</button><button class="u-ibtn5 u-ibtnsz1">取&nbsp;&nbsp;消</button> </div> </div> <div class="cover"> <div class="cvr u-artist u-artist-edit"> <img class="j-flag" onerror="nm.l.f.empty(this)"> </div> <div class="bar"> <button class="u-ibtn5 u-ibtnw3 j-flag">修改头像</button> </div> <input type="file" accept="image/*" class="j-flag f-dn"> </div> </div> </div> </textarea> <textarea name="ntp" id="m-pupd-pupdateexitpanel"> <div class="lyct"> <div class="m-lytxt"> <p class="p1">修改的信息尚未保存，是否保存后离开？</p> </div> </div> <div class="lybt"> <button type="button" class="j-flag u-ibtn1 u-ibtnsz1">保存</button><button type="button" class="j-flag u-btn3 u-btn3-c1 u-btnw1">不保存</button> </div> </textarea> <textarea name="js">(function(){var byz=NEJ.P,byA=byz("nej.e"),cN=byz("nej.j"),cJO=byz("nej.o"),bi=byz("nej.v"),kB=byz("nej.ui"),bp=byz("nm.d"),bR=byz("nm.l"),byx,byD;bR.baB=NEJ.C();byx=bR.baB.bS(bR.ir,!0);byD=bR.baB.prototype;byx.cJ=function(blZ){this.cK(blZ)};byx.eo=function(){this.Yl="m-pupd-pupdateexitpanel"};byx.byL=function(){this.byO();var dL=byA.bV(this.bA,"j-flag");bi.bM(dL[0],"click",this.tT.byB(this));bi.bM(dL[1],"click",this.tR.byB(this))};byx.tT=function(byy){this.bF("onsave",{});this.dy()};byx.xt=function(){this.tT()};byx.tR=function(byy){this.bF("onunsave",{});this.dy()}})();
(function(){var byz=NEJ.P,cJO=NEJ.O,co=NEJ.F,bm=byz("nej.u"),byA=byz("nej.e"),bi=byz("nej.v"),bU=byz("nej.ut"),bj=byz("nm.x"),bxI=byz("nm.i"),bp=byz("nm.d"),bY=byz("nm.m"),bC=byz("nm.m.p"),bR=byz("nm.l"),cN=byz("nej.ut.j"),byx,byD;bC.baC=NEJ.C();byx=bC.baC.bS(bY.cW);byx.byG=function(){this.bCU="m-pupd";this.dg();var bg=byA.bV(this.bA,"j-flag");this.pz=bg[0];this.bsp=bg[1];this.vl=bg[2].firstElementChild;this.baE=bg[3];this.bKI=bg[4];this.nl=bg[5];this.cnG=bg[6].firstElementChild;this.xN=bg[7];bi.bM(bg[0],"input",this.vA.byB(this));bi.bM(bg[3],"click",this.baG.byB(this));bi.bM(bg[4],"click",this.bOm.byB(this));bi.bM(bg[5],"click",this.baH.byB(this));bi.bM(bg[6].firstElementChild,"click",this.baI.byB(this));bi.bM(bg[6].lastElementChild,"click",this.bsy.byB(this));bi.bM(bg[8],"click",this.Ho.byB(this,bg[9]));bi.bM(bg[9],"change",this.wR.byB(this));this.Hk(bg[2].firstElementChild,bg[2].lastElementChild,140,this.baJ.byB(this));this.baK(bg[4].firstElementChild,this.bQU.byB(this));this.baK(bg[4].firstElementChild.nextElementSibling,this.bQV.byB(this));this.baK(bg[4].lastElementChild);this.baK(bg[5].firstElementChild,this.bsD.byB(this));this.baK(bg[5].lastElementChild);this.byJ={onnicknamecheck:this.bsE.byB(this),onprofileupdate:this.bsF.byB(this),onportraitupdate:this.bsG.byB(this),onstatcountload:this.bsH.byB(this),onerror:this.gF.byB(this)}};byx.dq=function(blZ){this.dC(blZ);!!this.bH&&this.bH.bQ();this.bH=bp.du.bG(this.byJ);this.gP()};byx.gP=function(){this.tW=[false,false,false,false,false];this.tW.valid=true;this.oF=null;byA.bK(this.cnG,"z-dis");this.bH.Iz(this.byK)};byx.bsH=function(fi){if(fi.userId==localCache.cF("host.profile.userId")){this.oF=fi;this.bsI()}};byx.bsI=function(){var fi=this.oF;this.jA=fi.nickname;this.pz.value=fi.nickname;this.vl.value=fi.signature;this.vl.focus();this.vl.blur();var ep=this.baE.firstElementChild,ik=fi.gender;while(ik){ep=ep.nextElementSibling;ik--}if(ep){ep.firstElementChild.firstElementChild.checked=true}var zf=new Date(fi.birthday<+(new Date(1920,0,1))?+(new Date(1990,0,1)):fi.birthday),bIG=zf.getFullYear(),bIL=zf.getMonth()+1,bIY=zf.getDate();this.bQW(bIG);this.bOn(bIG,bIL);this.bLx(bIG,bIL,bIY);this.bsJ(fi.province,fi.city);this.baL(fi.province,fi.city);this.xN.src=fi.avatarUrl+"?param=180y180&quality=100"};byx.bQW=function(bIG){var dT="",oK=!1,bk=this.bKI.firstElementChild;for(var i=1920,l=(new Date).getFullYear();i<=l;i++){dT+='<div class="option" value="'+i+'">'+i+"年</div>";if(i==bIG)oK=!0}bk.lastElementChild.firstElementChild.innerHTML=dT;this.GZ(bk.firstElementChild,oK?bIG+"年":"",oK?bIG:"")};byx.bOn=function(bIG,bIL){var dT="",oK=!1,bk=this.bKI.firstElementChild.nextElementSibling;for(var i=1,l=12;i<=l;i++){dT+='<div class="option" value="'+bIG+""+i+'">'+i+"月</div>";if(bIL==i)oK=!0}bk.lastElementChild.firstElementChild.innerHTML=dT;this.GZ(bk.firstElementChild,oK?bIL+"月":"",oK?bIG+""+bIL:"")};byx.bLx=function(bIG,bIL,bIY){var dT="",oK=!1,bk=this.bKI.lastElementChild;for(var i=1,l=this.bQX(bIG,bIL);i<=l;i++){dT+='<div class="option" value="'+bIG+""+bIL+""+i+'">'+i+"日</div>";if(bIY==i)oK=!0}bk.lastElementChild.firstElementChild.innerHTML=dT;this.GZ(bk.firstElementChild,oK?bIY+"日":"",oK?bIG+""+bIL+""+bIY:"")};byx.bQX=function(bIG,bIL){var bIY=0;bIG=Number(bIG)||0;bIL=Number(bIL)||0;if(bIG&&bIL){switch(bIL){case 1:case 3:case 5:case 7:case 8:case 10:case 12:bIY=31;break;case 4:case 6:case 9:case 11:bIY=30;break;case 2:var bQY=bIG%4==0&&bIG%100!=0||bIG%400==0;bIY=28+(bQY?1:0);break}}return bIY};byx.bsJ=function(gN,mR){var bsL=bj.beK(),dT="";bsL.forEach(function(gx){dT+='<div class="option" value="'+gx.id+'">'+gx.name+"</div>"});this.nl.firstElementChild.lastElementChild.firstElementChild.innerHTML=dT;this.GZ(this.nl.firstElementChild.firstElementChild,bj.Nw(gN),bj.bAO(gN)?bj.NQ(mR):gN)};byx.baL=function(gN,mR){var Cj=bj.bCY(gN,mR),dT="";if(Cj){for(var Ch in Cj){if(Cj.hasOwnProperty(Ch)){if(!mR)mR=Ch;dT+='<div class="option" value="'+Ch+'">'+Cj[Ch]+"</div>"}}}this.nl.lastElementChild.lastElementChild.firstElementChild.innerHTML=dT;if(bj.bAO(gN)){this.GZ(this.nl.lastElementChild.firstElementChild,bj.bBe(gN,gN),gN)}else{this.GZ(this.nl.lastElementChild.firstElementChild,bj.bBe(gN,mR),mR)}};byx.GZ=function(bk,bO,bo){if(bO){bk.textContent=bO;byA.bJ(bk,"value-none")}else{bk.textContent="请选择...";byA.bK(bk,"value-none")}bk.value=bo};byx.Go=function(){var ep=this.baE.firstElementChild,ik=0;do{if(ep.firstElementChild.firstElementChild.checked)break;ep=ep.nextElementSibling;ik++}while(ep);return ik};byx.bLr=function(){var jP=this.bKI.lastElementChild.firstElementChild.value||"",bE=jP.split(""),bIG=bE[0]||1990,bIL=(bE[1]||1)-1,bIY=bE[2]||1,zf=new Date(bIG,bIL,bIY);return zf.getTime()};byx.bwv=function(){this.vA();this.baJ();this.baG();this.bOm();this.baH()};byx.bsR=function(){var fi=this.oF||{},bzg={};if(this.pz.value.trim()!=fi.nickname)bzg.nickname=this.pz.value.trim();if(this.vl.value!=fi.signature)bzg.signature=this.vl.value;if(this.Go()!=fi.gender)bzg.gender=this.Go();if(this.bLr()!=fi.birthday)bzg.birthday=this.bLr();if(this.nl.firstElementChild.firstElementChild.value!=fi.province||this.nl.lastElementChild.firstElementChild.value!=fi.city){bzg.province=parseInt(this.nl.firstElementChild.firstElementChild.value);bzg.city=parseInt(this.nl.lastElementChild.firstElementChild.value);if(bzg.province<3)bzg.province=bzg.city}return bzg};byx.baI=function(byy){if(byA.ey(this.cnG,"z-dis"))return;if(this.tW.over){bj.ci({txt:"介绍字数超过限制"});return}bj.ci({state:"loading"});this.bH.bBm("profile",this.bsR())};byx.bsF=function(bn){switch(bn.code){case 200:bj.ci({txt:"修改个人资料成功",state:"success"});this.gP();break;default:bj.ci({txt:"修改个人资料失败"});break}};byx.gF=function(byy){if(bj.hi(byy)){bj.ci({txt:"网络不给力哦，请检查你的网络设置~"})}};byx.bsy=function(byy){if(byA.ey(this.cnG,"z-dis")||this.tW.over){this.mJ()}else{bR.pE.bG({title:"修改未保存",message:"修改的信息尚未保存，是否保存后离开？",okText:"保存",onok:this.baI.byB(this),oncancel:this.mJ.byB(this)}).dD()}};byx.mJ=function(){history.back()};byx.Ho=function(bk,byy){bi.bF(bk,"click")};byx.wR=function(byy){this.uO();this.pS=bR.Li.bG({parent:document.body,clazz:" m-layer-edt z-show",title:"上传头像",draggable:true,onok:this.Pl.byB(this),onclose:this.uO.byB(this)});this.pS.RA(byy);this.pS.dD();bi.cR(byy).value=""};byx.Pl=function(bh){bj.ci({state:"loading"});this.bH.bBm("portrait",{data:bh,html5:true})};byx.bsG=function(byy){if(byy.code==200){this.xN.src=byy.url+"?param=180y180&quality=100";dispatcher.gM({to:"/?/frame/top/",from:"",data:"onrefreshavatar",mode:0});bj.ci({state:"success",txt:"保存头像成功"});this.uO()}else{bj.ci({state:"failed",txt:"保存头像失败，请稍后再试"})}};byx.uO=function(){!!this.pS&&this.pS.bQ()};byx.bQU=function(bIG){this.bOn(bIG,1);this.bLx(bIG,1,1)};byx.bQV=function(bIL){var bE=(bIL||"").split("");this.bLx(bE[0],bE[1],1)};byx.bsD=function(gN){this.baL(gN)};byx.vA=function(){this.dm();var dM=this.pz.value.trim();if(dM==this.jA){this.bzO(0,false,true);return}var nZ=bm.rV(dM);if(nZ==0){this.dm("请输入昵称");this.bzO(0,true,false);return}if(nZ<4||nZ>30){this.dm("昵称为4-30个字，且不包含除-和_以外的特殊字符");this.bzO(0,true,false);return}if(!/^[\u4e00-\u9fa5A-Za-z0-9-_]*$/.test(dM)){this.dm("昵称为4-30个字，且不包含除-和_以外的特殊字符");this.bzO(0,true,false);return}this.bH.sX("nickname",{nickname:dM})};byx.bsE=function(bn){if(bn.code==200&&bn.nickname==this.pz.value.trim()&&bn.duplicated){this.dm("该昵称已被占用！");this.bzO(0,true,false)}else if(bn.code==200&&bn.nickname==this.pz.value.trim()&&!bn.duplicated){this.bzO(0,true,true)}else if(bn.code==407){this.dm("昵称包含违禁字符，请换一个");this.bzO(0,true,false)}};byx.dm=function(mr){this.bsp.textContent=mr||""};byx.baJ=function(){this.bzO(1,this.vl.value==localCache.cF("host.profile.signature")?false:true,this.vl.value.length<=140)};byx.baG=function(){this.bzO(2,this.Go()==localCache.cF("host.profile.gender")?false:true)};byx.bOm=function(byy){this.bzO(4,(this.oF||cJO).birthday!=this.bLr());bi.bQd(byy)};byx.baH=function(byy){var fi=this.oF||{},changed=false;if(bj.bAO(fi.province)){if(this.nl.lastElementChild.firstElementChild.value!=fi.province)changed=true}else{if(this.nl.firstElementChild.firstElementChild.value!=fi.province)changed=true;else if(this.nl.lastElementChild.firstElementChild.value!=fi.city)changed=true}this.bzO(3,changed);bi.bQd(byy)};byx.baK=function(){var bo=-1,bh=[],OY=function(){return true},bsX=function(bs,byy){var bsZ=byA.ey(bh[bs].select,"z-open");bi.bF(document.body,"click");if(bsZ)byA.bJ(bh[bs].select,"z-open");else byA.bK(bh[bs].select,"z-open")},bsY=function(bs,byy){var dF=byA.lh(bh[bs].value,"value"),eK=byA.lh(byy.srcElement,"value");if(!eK)return;bh[bs].value.textContent=byy.srcElement.textContent;bh[bs].value.value=byA.lh(byy.srcElement,"value");byA.bJ(bh[bs].value,"value-none");byA.bJ(bh[bs].select,"z-open");if(dF!=eK)bh[bs].onchange(eK)};bta=function(bs,byy){if(!bh[bs])return;if(byy.target==bh[bs].value)return;byA.bJ(bh[bs].select,"z-open")};return function(bk,btb){if(!bk)return;bo++;bh[bo]={select:bk,value:bk.firstElementChild,options:bk.lastElementChild.firstElementChild,onchange:btb||OY};bi.bM(bh[bo].value,"click",bsX.byB(null,bo));bi.bM(bh[bo].options,"click",bsY.byB(null,bo));bi.bM(document.body,"click",bta.byB(null,bo))}}();byx.Hk=function(){var pV=0,mB=null,ds=null,qX=null,OY=function(){return true},xD=function(){ds.value=ds.value.replace(/\n/g,"");var jP=ds.value;if(jP.length>pV){byA.bK(mB,"z-over")}else{byA.bJ(mB,"z-over")}mB.textContent=pV-ds.value.length;qX()};return function(eW,xB,bzc,fj){if(!eW||!xB)return;pV=bzc||140;mB=xB;ds=eW;qX=fj;bi.bM(eW,"input",xD);bi.bM(eW,"focus",xD)}}();byx.bzO=function(bq,btf,oY){this.tW[bq]=btf;if(bq==0)this.tW.valid=oY;if(bq==1)this.tW.over=!oY;if(this.tW.some(function(gx){return gx})&&this.tW.valid){byA.bJ(this.cnG,"z-dis")}else{byA.bK(this.cnG,"z-dis")}};bj.cU("/m/personal/edit/",bC.baC)})()</textarea>