<meta charset="utf-8"/> <textarea name="txt" id="m-share-friends-module"> <div> <div class="lyct"> <div class="m-seluser"> <div class="ipt"> <span class="sch"><svg><use xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#search"></use></svg></span> <div class="placeholder s-fc3 j-flag">请选择要分享的人</div> <div class="wrap s-scroll f-cb"> <p class="inputwrap"> <span class='input j-flag'></span> </p> <div class="cse j-flag"> <input type="text" class="j-flag s-fc1 empty"> </div> </div> </div> <div class="list s-scroll"> <ul class="j-flag"></ul> </div> </div> </div> <div class="lybt"> <button type="button" class="u-ibtn1 u-ibtnsz1 j-flag">下一步</button> </div> </div> </textarea> <textarea name ="ntp" id="m-share-friends-item"> <li> <span class="u-face u-face-2 j-flag"> </span> <div class="name j-flag">用户未定义</div> <span class="u-icn u-icn-selected"><svg><use xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#selected"></use></svg></span> </li> </textarea> <textarea name ="ntp" id="m-share-friends-selected-item"> <div class="itm"> <span class="j-flag">用户未定义</span> <span class="name-del j-flag"><svg><use xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#name_delete"></use></svg></span> </div> </textarea> <textarea name="js">(function(){var byz=NEJ.P,cJO=NEJ.O,byA=byz("nej.e"),bi=byz("nej.v"),bj=byz("nm.x"),bR=byz("nm.l"),bp=byz("nm.d"),bxI=byz("nm.i"),byx,byD,ccD;bxI.Ck=NEJ.C();byx=bxI.Ck.bS(bxI.jg);byx.byR=function(){this.bEc()};byx.cJ=function(blZ){this.dO([[this.bA,"click",this.zl.byB(this)]]);this.cK(blZ)};byx.zl=function(){this.tI=!this.tI;this.IJ();this.bF("checkItem",this.bW,this.tI,this)};byx.IJ=function(){!!this.tI?byA.bK(this.bA,"z-sel"):byA.bJ(this.bA,"z-sel")};byx.SJ=function(){this.tI=!this.tI;this.IJ()};byx.dH=function(){byA.bJ(this.bA,"z-sel");this.dI()};byx.eo=function(){this.Yl="m-share-friends-item"};byx.byL=function(){this.byO();var bg=byA.bV(this.bA,"j-flag");this.SK=bg[0];this.jL=bg[1]};byx.gP=function(bh){this.SK.innerHTML='<div class="wrap">'+ctl.commonJST.cFB("com-img",bh.avatarUrl,"30y30")+"</div>"+ctl.commonJST.cFB("com-user-type-2",bh,"flag");this.jL.innerText=bh.nickname;this.tI=false;this.IJ()};bxI.Ci=NEJ.C();byx=bxI.Ci.bS(bxI.jg);byx.byR=function(){this.bEc()};byx.cJ=function(blZ){this.dO([[this.bou,"click",this.boz.byB(this)]]);this.cK(blZ)};byx.boz=function(){this.bF("deleteItem",this.bW)};byx.eo=function(){this.Yl="m-share-friends-selected-item"};byx.byL=function(){this.byO();var bg=byA.bV(this.bA,"j-flag");this.jL=bg[0];this.bou=bg[1]};byx.gP=function(bh){this.jL.innerText=bh.nickname}})();
(function(){var byz=NEJ.P,cJO=NEJ.O,byA=byz("nej.e"),bi=byz("nej.v"),bm=byz("nej.u"),bD=byz("nej.n"),bU=byz("nej.ut"),bj=byz("nm.x"),bxI=byz("nm.i"),bp=byz("nm.d"),bY=byz("nm.m"),bC=byz("nm.m.c"),byx,byD;bC.SM=NEJ.C();byx=bC.SM.bS(bY.cW);byx.byG=function(){this.bCU="m-share-friends";this.dg();var bg=byA.bV(this.bA,"j-flag");this.wF=bg[0];this.SN=bg[1];this.bAb=bg[2];this.gW=bg[3];this.Iy=bg[4];bi.bM(bg[5],"click",this.bpd.byB(this));bi.bM(this.gW,"keydown",this.bBg.byB(this));bi.bM(this.gW,"keypress",this.bBg.byB(this));bi.bM(this.gW,"focus",this.jp.byB(this));bi.bM(this.gW,"blur",this.Iu.byB(this));bi.bM(this.gW,"input",this.wZ.byB(this));bi.bM(this.bAb.parentNode.parentNode,"click",this.bpj.byB(this))};byx.byT=function(blZ){this.cmx(blZ);this.fG=localCache.cF("host");if(!!this.bH)this.bH.bQ();this.bH=bp.du.bG({onlistload:this.rD.byB(this),onerror:this.gF.byB(this)});this.bH.fE({key:"user_follow-"+this.fG.profile.userId,offset:0,limit:1e4,data:{offset:0,limit:1e4,userId:this.fG.profile.userId}})};byx.bBg=function(byy){bi.sA(byy)};byx.jp=function(){this.wF.style.display="none";if(this.bAb.parentNode.scrollTop){this.bAb.parentNode.scrollTop=this.bAb.scrollHeight}};byx.Iu=function(){if(this.gW.value.length||this.gW.previousElementSibling){this.wF.style.display="none"}else{this.wF.style.display=""}};byx.wZ=function(byy){bi.bQd(byy);if(this.gW.value.length){this.SN.innerText=this.gW.value;byA.bJ(this.gW,"empty");this.gW.style.width=this.SN.clientWidth+16+"px"}else{byA.bK(this.gW,"empty");this.gW.style.width="7px"}this.rD();this.gW.focus()};byx.bpj=function(byy){this.gW.focus()};byx.rD=function(blZ){var eS=function(bg){if(this.gW.value=="")return bg;var t=this.gW.value.split("");var texp=".*"+t.join(".*")+".*";var dp=new RegExp(texp,"ig");var bzl=[];for(var i=0,l=bg.length;i<l;i++){if(dp.test(window.pinyin(bg[i].nickname))||dp.test(bg[i].nickname))bzl.push(bg[i])}return bzl}.bind(this);this.cY=this.bH.byI("user_follow-"+this.fG.profile.userId);if(!!blZ||this.SQ!=this.gW.value)this.SQ=this.gW.value;else return;if(this.cY.length==0){byA.eB(this.Iy,"m-common-empty-list",{text:"关注好友，即可分享音乐给ta"});return}else this.Iy.innerHTML="";var bg=eS(this.cY);if(!!this.or)this.or=bxI.Ck.bQ(this.or);this.or=byA.DP(bg,bxI.Ck,{parent:this.Iy,checkItem:this.bpp.byB(this)});this.SS=true;if(this.lX.length){for(var i=0,l=this.lX.length;i<l;i++){var gx=this.lX[i];for(var j=0,n=this.or.length;j<n;j++){var Ip=this.or[j];if(gx.userId==Ip.bW.userId&&!Ip.tI){bi.bF(Ip.bA,"click")}}}}this.SS=false};byx.eR=function(){this.or=bxI.Ck.bQ(this.or);this.wD=bxI.Ci.bQ(this.wD);delete this.or;delete this.wD;this.byU()};byx.bpp=function(bh,bpu,eE){if(this.SS)return;var bs=bm.eT(this.lX,function(bl){return bl.userId==bh.userId});if(bpu){if(bs==-1&&this.lX.length>=10){eE.SJ();bj.ci({txt:"最多同时分享给10个用户"})}else{if(bs==-1)this.lX.push(bh);if(this.gW.value){this.gW.value="";this.wZ()}}}else{if(bs!=-1)this.lX.splice(bs,1)}this.SV();this.gW.focus()};byx.SV=function(){if(this.wD)this.wD=bxI.Ci.bQ(this.wD);if(this.lX.length!=0){this.wD=byA.DP(this.lX,bxI.Ci,{parent:this.bAb,deleteItem:this.bpC.byB(this)});this.bAb.parentNode.scrollTop=this.bAb.scrollHeight;this.bAb.appendChild(this.gW);this.wF.style.display="none";bi.bF(this.bA,"resize")}else{if(this.gW.value=="")this.wF.style.display=""}};byx.bpC=function(bh){var bs=bm.eT(this.lX,function(bl){return bl.userId==bh.userId});if(bs!=-1){this.lX.splice(bs,1);this.SV();var bs=bm.eT(this.or,function(bl){return bl.jQ().userId==bh.userId});if(bs!=-1)this.or[bs].SJ()}this.gW.focus()};byx.dq=function(blZ){this.dC(blZ);this.gW.value="";this.SQ="";this.lX=[];this.wF.style.display="";this.jn=blZ.input.onclose;blZ.input.parent.replaceChild(this.bA,blZ.input.parent.firstChild);this.cbT=!1;bi.bF(this.bA,"resize")};byx.bpd=function(byy){if(this.lX.length>0){this.cbT=!0;dispatcher.dr("/?/share/",{input:{parent:this.bA.parentNode,users:this.lX,onclose:this.jn}})}};byx.gF=function(byy){if(bj.hi(byy)){bj.ci({txt:"网络不给力哦，请检查你的网络设置~"});byy.stopped=true}};byx.hA=function(bn){if(!bn||!bn.data||!bn.data.cmd)return;switch(bn.data.cmd){case"onenterpress":if(this.cbT){bj.gM("/?/share/",{cmd:"onenterpress"})}else{this.bpd()}break;case"aftershow":this.gW.focus();break}};bj.cU("/?/share/friends/",bC.SM)})()</textarea>