<meta charset="utf-8"/> <textarea name="txt" id="m-xcmt-module"> <div class="m-comment"> <div class="j-flag"></div> <div class="j-flag"> <li class="title s-fc4 j-flag">当前评论</li> <ul class="hotcmt j-flag"></ul> </div> <div class="j-flag"> <li class="title s-fc4 j-flag">精彩评论</li> <ul class="hotcmt j-flag"></ul> </div> <div class="j-flag"> <li class="title s-fc4 j-flag">最新评论</li> <ul class="j-flag"></ul> <div class="j-flag"></div> </div> </div> </textarea> <textarea name="ntp" id="m-xcmt-item"> <li class="citm f-cb" data-res-menu="true" data-res-type="9"></li> </textarea> <textarea name="jst" id="m-xcmt-hot-more"> <li class="citm citm-hotmore"><a class="s-fc3" href="#/m/comment/hot?rid=${rid}" data-da-event="n13a">查看更多精彩评论&nbsp;<i class="f-ff1 f-fwb s-fc5">&gt;</i></a></li> </textarea> <textarea name="txt" id="m-xcmt-more"> <li class="citm citm-more"> <a class="s-fc4 f-block" data-action="viewmore" href="javascript:void(0);">查看全部评论</a> </li> </textarea> <textarea name="jst" id="m-xcmt-content"> <div class="cface"> <a href="#/m/personal/?uid=${user.userId}" class="u-face u-face-3"> <div class="wrap">${commonJST('com-img', user.avatarUrl, '36y36')}</div> ${commonJST('com-user-type-2', user, 'flag')} </a> </div> <div class="cwrap"> <p class="f-ust"> <a href="#/m/personal/?uid=${user.userId}" class="s-fc2"> ${user.nickname}: </a> ${parseText(content)} </p> {if !!replier} <div class="reply s-fc3 f-ust"> {if !!replier.content} <p> <a href='#/m/personal/?uid=${replier.user.userId}' class="s-fc2"> @${replier.user.nickname}: </a> ${parseText(replier.content)} </p> {elseif replier.status==-10} <p class="del">该评论涉及违规内容，经举报已被屏蔽</p> {else} <p class="del">该评论已删除</p> {/if} </div> {/if} <div class="opers f-cb"> <span class="time s-fc5">${timeFormat(time)}</span> <a href="javascript:;" class="comment s-fc5" data-action="reply">回复</a> <span class="sep s-fc7">|</span> {if !hideShare} <a href="javascript:;" class="comment s-fc5" data-res-type="9" data-res-id="${id}" data-res-action="share" data-res-data="${rid}">分享</a> <span class="sep s-fc7">|</span> {/if} <a href="javascript:;" class="praise s-fc5 cmtid-${id}{if liked} z-did{/if}" data-action="praise"><svg><use xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#cmt_like"></use></svg>{if likedCount>0}(${likedCount}){/if}</a> {if !isMy}<span class="report"><a href="javascript:;" class="s-fc5" data-action="report">举报</a><span class="sep s-fc7">|</span></span>{/if} </div> </div> </textarea> <textarea name="js">(function(){var byz=NEJ.P,byA=byz("nej.e"),cN=byz("nej.j"),cJO=byz("nej.o"),bi=byz("nej.v"),bR=byz("nm.l"),bp=byz("nm.d"),bj=byz("nm.x"),byx,byD;bR.cXz=NEJ.C();byx=bR.cXz.bS(bR.ir,!0);byD=bR.cXz.prototype;byx.eo=function(){this.Yl="m-xwgt-layer-comment"};byx.byL=function(){this.byO();var ko=byA.bV(this.bA,"j-flag");this.Ur=ko.shift();this.Lj=ko.shift();this.dG={parent:this.Ur,onreply:this.daH.byB(this),hideSndBtn:true,editorClazz:"lyct m-editor",remain:true,ignoreAnonimous:true};this.byJ={onitemadd:this.bkA.byB(this),onitemadderror:this.bkC.byB(this)};bi.bM(this.Lj,"click",this.bbn.byB(this))};byx.cJ=function(blZ){blZ.title=blZ.title||"添加评论";blZ.clazz=blZ.clazz||"m-layer-comment";this.cK(blZ);this.cAf=blZ.successMsg;this.dG.placeholder=blZ.placeholder||"";!!this.ck&&this.ck.bQ();this.ck=bj.bzS.bG(this.dG);setTimeout(function(){!!this.ck&&this.ck.xP()}.byB(this),50);!!this.bH&&this.bH.bQ();this.bH=bp.cpa.bG(this.byJ);this.gU=blZ.msgKey;this.daG=blZ.reply;this.cNS=blZ.commentId;this.daE=blZ.threadId};byx.bbn=function(byy){!!this.ck&&this.ck.ED()};byx.daH=function(dU){byA.bK(this.Lj,"z-dis");this.Lj.innerText="发送中";if(!this.daG){this.bH.iL({data:{threadId:this.daE,content:dU.content},key:this.gU})}else{this.bH.ED({data:{commentId:this.cNS,threadId:this.daE,content:dU.content,notip:true},key:this.gU})}};byx.bkA=function(byy){byA.bJ(this.Lj,"z-dis");this.Lj.innerText="评 论";bj.ci({txt:this.cAf||"评论成功！",state:"success"});this.dy()};byx.bkC=function(byy){byA.bJ(this.Lj,"z-dis");this.Lj.innerText="评 论";byy=byy||{};var ds="";switch(byy.code){case 302:break;case 315:ds=byy.message||"根据对方设置，你没有该操作权限";break;case 407:ds="您输入的内容包含了敏感词汇，请重新检查";break;case 512:if(this.cre.type==2){ctl.order.cmY({data:{albumId:this.cre.id}})}else if(this.cre.type==4){dc.track.cTU(dc.track.cbd(this.cre.id,"",!0))}else{ds="评论失败，请稍后再试！"}break;default:ds=byy.message||"评论失败，请稍后再试！";break}if(ds){bj.ci({txt:ds})}}})();
(function(){var byz=NEJ.P,cJO=NEJ.O,byA=byz("nej.e"),bm=byz("nej.u"),bz=byz("nej.ut"),LS;if(!!bz.El)return;bz.El=NEJ.C();LS=bz.El.bS(bz.CL);LS.CU=function(){var dx=this.cY.length;if(!dx)return;var ux=Math.floor(dx/2),cr=Math.min(this.ix-dx+1,Math.max(1,this.cZ-ux));bm.cj(this.cY,function(bk,bs){var LO=cr+bs;this.wK(bk,LO>this.ix||LO<1?null:LO)},this)};LS.bxV=function(OF){if(!OF){this.ix=Number.MAX_VALUE}else{this.ix=this.cZ}this.JM()}})();
(function(){var byz=NEJ.P,cJO=NEJ.O,dz=NEJ.R,byA=byz("nej.e"),bm=byz("nej.u"),bU=byz("nej.ut"),bz=byz("nej.ui"),byx,ccD;if(!!bz.wJ)return;bz.wJ=NEJ.C();byx=bz.wJ.bS(bz.zs);byx.cJ=function(blZ){blZ.number=parseInt(blZ.number)||1;if(blZ.total==null)blZ.total=1e4;this.cK(blZ);this.ls=bU.El.bG(this.eG)}})();
(function(){var byz=NEJ.P,cJO=NEJ.O,byA=byz("nej.e"),bi=byz("nej.v"),bm=byz("nej.u"),bU=byz("nej.ut"),cmw=byz("nej.ui"),bj=byz("nm.x"),bxI=byz("nm.i"),bp=byz("nm.d"),bTG=byz("nm.c"),bR=byz("nm.l"),bY=byz("nm.m"),bC=byz("nm.m.x"),byx,byD;bC.tg=NEJ.C();byx=bC.tg.bS(bY.cW);byx.byG=function(){this.bCU="m-xcmt";this.dg();this.cWk=byA.Vx("m-xwgt-replier-st");var bg=byA.bV(this.bA,"j-flag");this.JB=bg.shift();this.cPX=bg.shift();this.cPq=bg.shift();this.cPr=bg.shift();this.czH=bg.shift();this.cvP=bg.shift();this.cvO=bg.shift();this.czG=bg.shift();this.cvR=bg.shift();this.cvQ=bg.shift();this.bFn=bg.shift();this.bll={item:{klass:bxI.RZ,onreply:this.bkx.byB(this),onpraise:this.ctC.byB(this),onactivity:this.dfb.byB(this)},cache:{klass:bp.cpa,clear:!0},parent:this.cPr,head:this.cPq,onemptylist:this.sW.byB(this,"cur"),onbeforelistclear:this.bzb.byB(this)};this.cnn={item:{klass:bxI.RZ,onreply:this.bkx.byB(this),onpraise:this.ctC.byB(this),onactivity:this.dfb.byB(this)},cache:{klass:bp.cpa,clear:!0},parent:this.cvO,head:this.cvP,onemptylist:this.sW.byB(this,"hot"),onbeforelistclear:this.bzb.byB(this)};this.bL={item:{klass:bxI.RZ,onreply:this.bkx.byB(this),onpraise:this.ctC.byB(this),onactivity:this.dfb.byB(this)},cache:{klass:bp.cpa,onitemadd:this.bkA.byB(this),onitemadderror:this.bkC.byB(this),onlisterror:this.sZ.byP(this,this.cvQ),onerror:this.gF.byB(this,this.ej.byP(this,true,this.cvQ)),clear:true},parent:this.cvQ,head:this.cvR,onemptylist:this.sW.byB(this,"new"),onafterlistload:this.bzK.byB(this),onbeforelistload:this.im.byB(this,"m-xwgt-list-loading"),onafterpullrefresh:this.og.byB(this),onbeforepullrefresh:this.im.byB(this,"m-xwgt-list-loading"),onbeforelistclear:this.bzb.byB(this),ondelete:this.bkD.byB(this),onbeforelistrender:this.bkJ.byB(this),onafterlistrender:this.hR.byB(this),onpagechange:this.bzC.byB(this)};this.dG={btnText:"评论",onreply:this.bkH.byB(this),editorClazz:"m-editor m-editor-md m-editor-nopd",btnClazz:"submit u-ibtn5",remain:true,ignoreAnonimous:!0,parent:this.JB};bi.bM(bp.cpa,"listchange",function(byy){if(this.cYV&&byy.isAdd){var bu=(byy.key||"").split("-");if(bu&&bu[1]&&bu[1]==this.bL.item.rid){this.cw.hM()}}}.byB(this))};byx.bkH=function(bh){if(this.ctD())return;if(bj.btm()){bj.bNt("comment-add");return}if(navigator.offline){bj.ci({txt:"网络不给力哦，请检查你的网络设置~"});return}this.ck.xk({btnText:"发送中",btnClazz:"z-dis"});if(bh.reply){delete bh.reply;this.cw.rY().ED(bh)}else{this.cw.dE({threadId:this.bL.cache.data.rid,remain:true,content:bh.content})}};var cdX={1:"playlist",2:"album",4:"track",8:"event"};byx.dq=function(blZ){this.dC(blZ);var bP=blZ.param||cJO,dM=blZ.input||cJO,cJN=this.bL.cache,hs=bP.rid==="{commentThreadId}"?dM.rid:bP.rid||dM.rid,bDg=bP.blur||dM.blur||false,bcI=bP.delay||dM.delay||false,bGX=bP.dtime||dM.dtime||0,bs=bP.index||dM.index||1,bRP=bj.AY(hs),dR=bP.defaultCount||dM.defaultCount||0;this.gH=cdX[bRP.type];this.bL.limit=dM.limit||60;this.bL.count=dM.count||1;byA.bJ(this.bA,"m-comment-detail m-comment-list m-comment-play m-comment-timeline");switch(this.gq){case"/?/comment/song/":byA.bK(this.bA,"m-comment-detail");this.bL.limit=20;this.bL.count=1;break;case"/?/comment/detail/":case"/?/fmcomment/detail/":this.cYV=true;case"/?/mvcomment/detail/":byA.bK(this.bA,"m-comment-play");break;case"/?/comment/event/":byA.bK(this.bA,"m-comment-timeline");this.kU=1;break;case"/?/comment/":if(this.gH=="album"||this.gH=="playlist"){byA.bK(this.bA,"m-comment-list")}else if(this.gH=="event"){byA.bK(this.bA,"m-comment-detail");this.kU=2}break;default:logger.warn("error umi: "+this.gq);break}this.kU=dM.mode||this.kU||0;this.cNS=bP.commentId||dM.commentId;this.bma=bP.hidePager||dM.hidePager;cJN.data={rid:hs};if(!!this.cNS){cJN.data.commentId=this.cNS}cJN.lkey="comment-"+hs;cJN.type=bP.type||dM.type;this.dG.msgKey=cJN.lkey;if(!this.kU){this.dG.editorClazz="m-editor m-editor-md m-editor-nopd";this.bL.onbeforelistload=this.Ak.byB(this);this.bL.onbeforepullrefresh=this.LX.byB(this)}else{this.dG.editorClazz="m-editor";this.bL.onbeforelistload=this.im.byB(this,"m-xwgt-event-comment-list-loading");this.bL.onbeforepullrefresh=this.im.byB(this,"m-xwgt-event-comment-list-loading")}this.cnn.cache.lkey="comment_hot-"+hs;byA.bK(this.czH,"f-dn");this.bll.cache.lkey="comment_cur-"+hs;byA.bK(this.cPX,"f-dn");this.cvR.innerText="最新评论"+(dR?"("+dR+")":"");byA.bJ(this.cvR,"f-dn");this.bL.item.mode=this.kU;this.bL.item.rid=hs;this.cnn.item.mode=this.kU;this.cnn.item.rid=hs;this.bll.item.mode=this.kU;this.bll.item.rid=hs;if(this.kU!=1){this.bL.delta=30;this.bL.sbody=!this.kU?document.mbody:document.mbody.firstElementChild;this.bL.pager={parent:this.bFn,clazz:this.kU==0?"m-page":"m-page m-page-wt",label:{prev:'<svg><use xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#page_pre"></use>上一页</svg>',next:'<svg><use xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#page_next"></use>下一页</svg>'}}}else{this.bL.limit=10;if(!!this.bL.delta)delete this.bL.delta;if(!!this.bL.count)delete this.bL.count;if(!!this.bL.sbody)delete this.bL.sbody;if(!!this.bL.pager)delete this.bL.pager}if(this.bL.pager&&this.bL.pager.parent){if(this.bma){byA.bK(this.bL.pager.parent,"f-dn")}else{byA.bJ(this.bL.pager.parent,"f-dn")}this.bL.pager.index=bs}if(this.cYV){this.dG.parent.appendChild(this.cWk);byA.bT(this.cWk,"resAction","opencomment");byA.bT(this.cWk,"resId",bRP.id);byA.bT(this.cWk,"resType",bRP.type)}else{if(!!this.ck){this.ck=bj.bzS.bQ(this.ck)}this.ck=bj.bzS.bG(this.dG)}if(this.cw){this.cw=this.cw.bQ()}if(this.cpJ){this.cpJ=this.cpJ.bQ()}if(this.cMw){this.cMw=this.cMw.bQ()}clearTimeout(this.bFi);this.bL.parent.innerHTML="";if(bcI){this.bL.parent.innerHTML=byA.gy("m-xwgt-list-loading");this.bFi=setTimeout(function(){this.bL.parent.innerHTML="";this.cw=bU.jN.bG(this.bL)}.byB(this),bGX)}else{this.cw=bU.jN.bG(this.bL)}if(this.kU==1){this.CE=bP.close||dM.close}this.cre=bj.AY(hs);if(this.cQz)this.cQz.bQ();this.cQz=bp.cTb.bG({onactivitytitle:this.ddp.byB(this),onactivitytitleerror:this.ddo.byB(this)});if(bDg)return;if(this.kU==1)setTimeout(function(){if(this.ck)this.ck.xP()}.byB(this),50);this.ck.xP()};byx.sW=function(bq,byy){if(bq=="new"){if(this.bL&&this.cvR){this.cvR.innerText="最新评论";byA.bK(this.cvR,"f-dn")}if(!this.kU){byy.value=byA.gk("m-comment-empty-list-black-bg",{text:"还没有评论，快来抢沙发~"})}else{this.im("m-xevt-list-empty",byy)}if(this.bL&&this.bL.parent){this.bL.parent.style.height=""}}else if(bq=="hot"){if(this.cpJ){byA.bK(this.czH,"f-dn");this.cpJ=this.cpJ.bQ()}}else if(bq=="cur"){if(this.cMw){byA.bK(this.cPX,"f-dn");this.cMw=this.cMw.bQ()}}};byx.bkM=function(){if(this.kU==1&&this.CE){this.CE();delete this.CE}};byx.eR=function(){clearTimeout(this.bFi);this.byU();if(this.cw)this.cw=this.cw.bQ();if(this.cpJ)this.cpJ=this.cpJ.bQ();if(this.cMw)this.cMw=this.cMw.bQ();byA.kO(this.cWk);if(!!this.bL.delta)delete this.bL.delta;if(!!this.bL.count)delete this.bL.count;if(!!this.bL.sbody)delete this.bL.sbody;if(!!this.bL.pager)delete this.bL.pager;if(!!this.CE)delete this.CE;if(this.kU!==undefined)delete this.kU;this.sH=!1};byx.bkD=function(byy){var bh=byy.data||cJO;this.cw.bgB({commentId:bh.commentId,threadId:this.bL.cache.data.rid})};byx.bkA=function(blZ){this.ck.rJ({btnText:"评论",btnClazz:"z-dis"});this.ck.btp();bj.ci({txt:"评论成功！",state:"success"})};byx.bkx=function(byy){byy.threadId=this.bL.cache.data.rid;if(this.cYV){document.action({id:byy.commentId,tid:byy.threadId,type:9,action:"opencomment",ext:byy.user});return}var bkV={data:byy,ext:byy.id,key:this.bL.cache.lkey,prefix:"回复"+byy.user.nickname+"："};this.ck.blx(bkV)};byx.ctC=function(byy){if(this.cw&&this.cw.rY()){this.cw.rY().cbY(this.bL.cache.data.rid,byy.commentId,byy.praised,this.ctE.byB(this,byy.commentId))}};byx.ctE=function(bTj,byy){if(!byy||byy.code!=200&&byy.code!=400)return;if(this.cw&&this.cw.rY()){var caO=this.cw.rY().cl(bTj);if(caO){if(this.bL.parent&&this.czG&&this.czG.parentNode){var ko=this.czG.parentNode.querySelectorAll(".cmtid-"+bTj);bm.cj(ko,function(bk){if(caO.liked){byA.bK(bk,"z-did")}else{byA.bJ(bk,"z-did")}if(bk.childNodes[1]){bk.childNodes[1].nodeValue="("+caO.likedCount+")"}else{bk.appendChild(document.createTextNode("("+caO.likedCount+")"))}},this)}}}};byx.bkC=function(byy){this.ck.rJ({btnText:"评论",btnClazz:"z-dis"});byy=byy||{};var ds="";switch(byy.code){case 302:break;case 315:ds=byy.message||"根据对方设置，你没有该操作权限";break;case 407:ds="您输入的内容包含了敏感词汇，请重新检查";break;case 512:if(this.cre.type==2){ctl.order.cmY({data:{albumId:this.cre.id}})}else if(this.cre.type==4){dc.track.cTU(dc.track.cbd(this.cre.id,"",!0))}else{ds="评论失败，请稍后再试！"}break;default:ds=byy.message||"评论失败，请稍后再试！";break}if(ds){bj.ci({txt:ds})}};byx.gF=function(fj,byy){if(bj.hi(byy)){if(this.ck)this.ck=this.ck.bQ();fj(null)}};byx.bkJ=function(byy){this.bNl=!1;if(byy&&byy.options){if(this.cw&&this.cw.rY()){var cJN=this.cw.rY();if(cJN){var bg=cJN.byI("comment_hot-"+byy.options.data.rid);if(bg&&bg.length){if(byy.options.offset==0){if(!this.cpJ){this.cvP.innerText="精彩评论";this.cpJ=bU.jN.bG(this.cnn);if(byy.options.moreHot){var dT=byA.gk("m-xcmt-hot-more",{rid:byy.options.data.rid});this.cvO.insertAdjacentHTML("beforeEnd",dT)}}byA.bJ(this.czH,"f-dn")}else{byA.bK(this.czH,"f-dn")}}if(this.cNS){var bg=cJN.byI("comment_cur-"+byy.options.data.rid);if(byy.options.offset==0){if(bg&&bg.length){if(!this.cMw||this.cdY!=this.cNS){this.cdY=this.cNS;this.cPq.innerText="当前评论";this.cMw=bU.jN.bG(this.bll);if(this.gH=="playlist"||this.gH=="album")this.bNl=!0}}else{this.cPq.innerText="当前评论";this.bll.parent.innerHTML='<li><div class="reply" style="margin-top:14px;"><p class="del">该评论已删除</p></div></li>'}byA.bJ(this.cPX,"f-dn")}else{byA.bK(this.cPX,"f-dn")}}}}}if(byy&&byy.list){if(this.bL&&this.cvR){this.cvR.innerText="最新评论"+(!!byy.list.length?"("+byy.list.length+")":"")}}};byx.hR=function(byy){if(this.bNl){this.bNl=!1;if(this.dG.parent){var cr=byA.lp(this.dG.parent,document.mbody);document.mbody.scrollTop=cr.y-65}}else if(this.sH&&this.kU!=1){if(!!this.cMw&&this.bll&&this.cPq&&this.cPq.scrollIntoView&&!byA.ey(this.cPX,"f-dn"))this.cPq.scrollIntoView(!0);else if(!!this.cpJ&&this.cnn&&this.cvP&&this.cvP.scrollIntoView&&!byA.ey(this.czH,"f-dn"))this.cvP.scrollIntoView(!0);else if(!!this.cw&&this.bL&&this.cvR&&this.cvR.scrollIntoView&&!byA.ey(this.czG,"f-dn"))this.cvR.scrollIntoView(!0)}this.bL.parent.style.height="";this.sH=!1};byx.bzC=function(byy){if(byy.last==byy.index)return;if(this.kU!=1){this.bL.parent.style.height=this.bL.parent.scrollHeight+"px";if(!!this.cMw&&this.bll&&this.cPq&&this.cPq.scrollIntoView&&!byA.ey(this.cPX,"f-dn"))this.cPq.scrollIntoView(!0);else if(!!this.cpJ&&this.cnn&&this.cvP&&this.cvP.scrollIntoView&&!byA.ey(this.czH,"f-dn"))this.cvP.scrollIntoView(!0);else if(!!this.cw&&this.bL&&this.cvR&&this.cvR.scrollIntoView&&!byA.ey(this.czG,"f-dn"))this.cvR.scrollIntoView(!0)}this.sH=!0};byx.ctD=function(){var crf=!1;if(this.cre){if(this.cre.type==2||this.cre.type==4){var bg;if(this.cre.type==2){bg=dc.track.byI("track_album-"+this.cre.id)}else{bg=[dc.track.cl(this.cre.id)]}if(bg&&bg.length){var bs=bm.eT(bg,function(bl){return bl&&dc.track.cSH(bl)});if(bs<0){crf=!0;dc.track.bJO(bg,"comment")}}}else if(this.cre.type==10){if(!dc.mv.cSH(this.cre.id)){crf=!0;dc.mv.bJO(this.cre.id,"comment")}}}return crf};byx.dgs=function(){this.ck.xP()};byx.hA=function(byy){if(byy&&byy.data){var bh=byy.data;switch(bh.cmd){case"refreshmore":if(bh.rid==this.bL.item.rid){var ik=bh.num;if(ik>10){this.bFn.innerHTML=byA.gy("m-xcmt-more")}else{this.bFn.innerHTML=""}}break;case"close":this.bkM();break;case"focus":this.dgs();break}}};byx.dfb=function(oS){this.cQz.ddF(oS)};byx.ddp=function(cRq){if(cRq.act){location.href="#/m/friend/activity?id="+cRq.act.actId+"&r="+Math.random()}else{bj.ci({txt:"该话题暂未创建"})}};byx.ddo=function(){bj.ci({txt:"该话题暂未创建"})};bj.cU("/?/comment/",bC.tg);bj.cU("/?/comment/event/",bC.tg);bj.cU("/?/comment/detail/",bC.tg);bj.cU("/?/mvcomment/detail/",bC.tg);bj.cU("/?/fmcomment/detail/",bC.tg);bj.cU("/?/comment/song/",bC.tg)})()</textarea>