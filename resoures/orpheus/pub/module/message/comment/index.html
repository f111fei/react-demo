<meta charset="utf-8"/> <textarea name="txt" id="m-scmt-module"> <ol class="m-cmtlist s-layscroll"></ol> </textarea> <textarea name="ntp" id="m-scmt-item"> <li data-res-type="7" data-res-menu="true" data-res-from="-12"> <div class="f-cb"> <a data-action="redirect" href="javascript:void(0);" class="u-face u-face-6"><div class="wrap"><img class="j-flag"></div></a> <div class="cmtcnt"> <div class="cmtcntc"> <div class="cmtname"> <a data-action="redirect" href="javascript:void(0);" class="j-flag name s-fc2"></a> <sup data-action="redirect" class="j-flag badge f-dn"></sup> <time class="j-flag s-fc4"></time> </div> <div class="cmtsay"><span class="j-flag"></span><span class="j-flag cmttxt f-ust"></span></div> <div data-action="redirect2" class="j-flag cmtcite">我分享歌单：「单身情歌-林志炫」</div> <div class="doper"> <span class="f-cp btn s-fc3" data-action="reply"><svg><use xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#timeline_cmt"></use></svg> 回复</span> </div> </div> </div> </div> <div class="j-flag u-msg s-fc3">回复成功</div> <div class="j-flag"></div> </li> </textarea> <textarea name="js">(function(){var byz=NEJ.P,byA=byz("nej.e"),bi=byz("nej.v"),bm=byz("nej.u"),fH=byz("nej.cef"),bj=byz("nm.x"),bxI=byz("nm.i"),bR=byz("nm.l"),bp=byz("nm.d"),bD=byz("nej.n"),byx,byD;bxI.bDc=NEJ.C();byx=bxI.bDc.bS(bxI.jg);byx.dH=function(){this.dI()};byx.eo=function(){this.Yl="m-scmt-item"};byx.byL=function(){this.byO();var bg=byA.bV(this.bA,"j-flag");this.xw=bg.shift();this.ow=bg.shift();this.bzy=bg.shift();this.sG=bg.shift();this.bhr=bg.shift();this.bhj=bg.shift();this.Kl=bg.shift();this.iG=bg.shift();this.Ov=bg.shift();bi.bM(this.bA,"click",this.ei.byB(this));this.byJ={onreply:this.bgR.byB(this)};this.bAT={onitemload:this.VO.byB(this),onlisterror:this.VO.byB(this)}};byx.gP=function(bh){if(!bh.combindId){byA.bK(this.bA,"f-dn");return}byA.bJ(this.bA,"f-dn");byA.bT(this.bA,"resId",bh.combindId);this.xw.src=bh.user.avatarUrl+"?param=32y32&quality=100";this.ddA&&byA.lG(this.ddA);this.ddA=byA.xQ(ctl.commonJST.cFB("com-user-type-2",bh.user,"flag"));this.ddA&&this.xw.parentNode.parentNode.appendChild(this.ddA);this.sG.innerText=bj.rP(bh.time,true);this.ow.innerHTML=bj.fg(bh.user.nickname);this.ow.parentNode.appendChild(this.sG);var XY=ctl.commonJST.cFB("com-user-type",bh.beRepliedUser);this.bhr.innerHTML=!bh.beRepliedUser?"":"回复"+(bh.beRepliedUser.userId==localCache.cF("host.profile.userId")?"我：":'<a class="s-fc2 j-atlink" href="#/m/personal/?uid='+bh.beRepliedUser.userId+'">'+bh.beRepliedUser.nickname+XY+"</a>：");this.bhj.innerHTML=bj.lO(bh.content,{parseAct:true});this.Kl.innerHTML=bj.lO(bh.beRepliedContent,{parseAct:true});byA.bJ(this.Kl,"f-cd");if(bm.eA(bh.resourceJson))bh.resourceJson=JSON.parse(bh.resourceJson);if(bh.resourceType==2){var lD=this.bW.resourceJson.eventType;if(nm.filter.lg(nm.filter.TYPE.EVENT,lD)){if(lD==12||lD==14||lD==23||lD==27||lD==29){byA.bK(this.Kl,"f-cd")}}else{this.Kl.innerHTML='<p class="s-fc3">你当前的应用版本无法显示这条信息</p>';byA.bK(this.Kl,"f-cd")}}else if(!nm.filter.lg(nm.filter.TYPE.CM_MSG,bh.resourceType)){this.Kl.innerHTML='<p class="s-fc3">你当前的应用版本无法显示这条信息</p>';byA.bK(this.Kl,"f-cd")}};byx.ei=function(byy){if(this.qk(byy))return;var bk=bi.cR(byy,"d:action"),cX=byA.bT(bk,"action");if(!bk)return;bi.bQd(byy);switch(cX){case"play":!!this.fW&&this.fW.bQ();this.fW=bp.kj.bG(this.bAT);this.fW.hv({id:this.bW.resourceJson.id,key:"event-"+this.bW.resourceJson.userId,data:{userId:this.bW.resourceJson.userId,id:this.bW.resourceJson.id}});break;case"reply":this.bF("onreply",{parent:this.Ov,onreply:this.Fr.byB(this),id:this.byZ});break;case"redirect":dispatcher.dr("/m/personal/?uid="+this.bW.user.userId);this.bzj();break;case"redirect2":if(byA.ey(this.Kl,"f-cd"))break;var bo=this.bW.resourceJson.id,fr=this.bW.id.split(":")||[],bTj=fr[1],hs=fr[2],byC="";if(!hs){logger.warn("combindId err",this.bW.id,"comment.js")}switch(this.bW.resourceType){case 0:byC="/m/playlist/comment/?id="+bo+"&rid="+hs;break;case 1:byC="/m/song?id="+bo+"&rid="+hs;break;case 2:var lD=this.bW.resourceJson.eventType;if(lD==12||lD==14||lD==23||lD==27||lD==29)return;byC="/m/friend/event/?id="+bo+"&uid="+this.bW.resourceJson.userId;break;case 3:byC="/m/album/comment/?id="+bo+"&rid="+hs;break;case 4:byC="/m/song?id="+bo+"&rid="+hs;break;case 5:byC="/m/song?id="+bo+"&rid="+hs;break;case 6:this.bF("ontopic",bo);break;default:logger.warn("resourceType err",this.bW.resourceType,"comment.js");break}if(byC){if(bTj){byC=byC+"&commentId="+bTj}dispatcher.dr(byC)}this.bzj();break;case"activity":var oS=byA.bT(bk,"title");oS=/^#(.+?)#$/.exec(oS)[1];this.bzj();this.bF("onactivity",oS);break}};byx.qk=function(byy){if(byA.ey(byy.srcElement,"j-atlink")){if(location.href!=byy.srcElement.href)location.href=byy.srcElement.href;this.bzj();return true}return false};byx.bzj=function(){dispatcher.gM({to:"/?/frame/top/",from:"",data:"onclose",mode:0})};byx.Fr=function(byy){if(!!this.bH)this.bH.bQ();this.bH=bp.bzn.bG(this.byJ);this.bF("onlock",{id:this.byZ});this.bH.ED({data:{combindId:this.bW.combindId,content:byy.content},onerror:this.Om.byB(this)})};byx.bgR=function(bn){this.bF("onunlock",{id:this.byZ});if(bn.data.code==200){byA.bK(this.iG,"z-show");setTimeout(function(){byA.bJ(this.iG,"z-show")}.bind(this),2e3);this.bF("onclose",{id:this.byZ})}};byx.Om=function(bn){var mt={407:"您输入的内容包含了敏感词汇，请重新检查",315:"根据对方设置，你没有该操作权限"};this.bF("onunlock",{id:this.byZ});bj.ci({txt:mt[(bn||cJO).code]||"回复评论失败，请稍后再试！"})};byx.VO=function(blZ){if(blZ.key=="event-"+this.bW.resourceJson.userId){if(blZ.code){bj.ci({txt:"获取歌曲信息失败，不能播放歌曲，请稍后再试"});return}var bh=this.fW.cl(this.bW.resourceJson.id);if(bm.eA(bh.json))bh.json=JSON.parse(bh.json);this.rz(bh.json.song.id)}};byx.rz=function(bgO){bi.bF(document,"click",{res:{type:"4",action:"play",ext:"showPlaying",from:"-12",id:bgO}})}})();
(function(){var byz=NEJ.P,cJO=NEJ.O,byA=byz("nej.e"),bi=byz("nej.v"),bU=byz("nej.ut"),bj=byz("nm.x"),bxI=byz("nm.i"),bp=byz("nm.d"),bY=byz("nm.m"),bC=byz("nm.m.s"),byx,byD;bC.tg=NEJ.C();byx=bC.tg.bS(bY.cW);byx.byG=function(){this.bCU="m-scmt";this.dg();this.bL={limit:10,parent:this.bA,sbody:this.bA,delta:30,item:{klass:bxI.bDc,onreply:this.bCn.byB(this),onlock:this.NZ.byB(this),onunlock:this.NE.byB(this),onclose:this.MD.byB(this),onactivity:this.dfb.byB(this),ontopic:this.cgf.byB(this)},cache:{klass:bp.bzn,clear:true,onlisterror:this.sZ.byP(this,this.bA)},onemptylist:this.bAe.byB(this,"暂无评论内容"),onafterlistload:this.bzK.byB(this),onbeforelistload:this.im.byB(this,"m-xwgt-white-list-loading"),onafterpullrefresh:this.og.byB(this),onbeforepullrefresh:this.im.byB(this,"m-xwgt-white-list-loading"),onbeforelistclear:this.bzb.byB(this)};this.bL.cache.onerror=this.ej.byP(this,true,this.bL.parent)};byx.dq=function(blZ){this.dC(blZ);if(bj.btm()){byA.eB(this.bA,"m-common-empty-list",{text:"暂无评论内容"});return}var cJN=this.bL.cache,bZ=localCache.cF("host.profile.userId");cJN.lkey="message_comment-"+bZ;cJN.data={uid:bZ};if(!!this.cw)this.cw.bQ();this.cw=bU.jN.bG(this.bL);this.dG={parent:null,onreply:null,remain:true,editorClazz:"m-editor m-editor-msgcmt"};this.nX=null;!!this.hG&&this.hG.bQ();if(this.cQz)this.cQz.bQ();this.cQz=bp.cTb.bG({onactivitytitle:this.ddp.byB(this),onactivitytitleerror:this.ddo.byB(this)});if(this.dfe)this.dfe.bQ();this.dfe=bp.cVD.bG({onitemload:this.dft.byB(this),ontopicerror:this.dfv.byB(this)})};byx.hA=function(bn){if(!!bn&&bn.data=="onrefresh"){this.dq({})}};byx.bCn=function(blZ){if(blZ.id==this.nX){if(!!this.hG.bA.parentNode.tagName){this.hG.dy()}else{this.hG.dD();this.hG.xP()}}else{if(this.hG)this.hG.bQ();this.dG.parent=blZ.parent;this.dG.onreply=blZ.onreply;this.dG.msgKey="message_comment-"+blZ.id;this.nX=blZ.id;this.hG=bj.bzS.bG(this.dG);this.hG.xP()}};byx.NZ=function(blZ){if(this.nX==blZ.id){this.hG.xk({btnText:"发送中",btnClazz:"z-dis"})}};byx.NE=function(blZ){if(this.nX==blZ.id){this.hG.rJ({btnText:"发送",btnClazz:"z-dis"})}};byx.MD=function(blZ){if(this.nX==blZ.id){this.hG.btp();this.hG.dy()}};byx.dfb=function(oS){this.cQz.ddF(oS)};byx.ddp=function(cRq){if(cRq.act){location.href="#/m/friend/activity?id="+cRq.act.actId+"&r="+Math.random()}else{bj.ci({txt:"该话题暂未创建"})}};byx.ddo=function(){bj.ci({txt:"该话题暂未创建"})};byx.cgf=function(dgq){this.dfe.dfq(dgq)};byx.dft=function(byy){var bJB=this.dfe.cl(byy.id);if(bJB.number==0||bJB.status==-1){bj.ci({txt:"该资源已不存在"})}else{dispatcher.dr("/m/topic/?id="+byy.id)}};byx.dfv=function(){bj.ci({txt:"该资源已不存在"})};bj.cU("/?/message/comment/",bC.tg)})()</textarea>