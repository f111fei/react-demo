<meta charset="utf-8"/> <textarea name="txt" id="m-sfrm-module"> <ul class="u-tabbtn"> <li class="btn">@我<span class="j-flag u-tip" style="display:none;"></span></li> <li class="btn">私信<span class="j-flag u-tip" style="display:none;"></span></li> <li class="btn">评论<span class="j-flag u-tip" style="display:none;"></span></li> <li class="btn">通知<span class="j-flag u-tip" style="display:none;"></span></li> </ul> </textarea> <textarea name="js">(function(){var byz=NEJ.P,cJO=NEJ.O,byA=byz("nej.e"),bi=byz("nej.v"),bm=byz("nej.u"),bU=byz("nej.ut"),bj=byz("nm.x"),bxI=byz("nm.i"),bp=byz("nm.d"),bY=byz("nm.m"),bC=byz("nm.m.s"),byx,byD;bC.nN=NEJ.C();byx=bC.nN.bS(bY.cW);byx.byG=function(){this.bCU="m-sfrm";this.dg();this.Jg=byA.gj(this.bA);this.iG=byA.bV(this.bA,"j-flag");for(var i=0,bg=this.Jg;i<bg.length;bi.bM(bg[i],"click",this.Av.byB(this,i)),++i);bi.bM(bp.mx,"message",this.hA.byB(this))};byx.dq=function(blZ){this.dC(blZ);var bgJ=this.cZ,uR=blZ.target=="/?/message/at/"?0:blZ.target=="/?/message/private/"?1:blZ.target=="/?/message/comment/"?2:blZ.target=="/?/message/notify/"?3:-1;this.bA.style.display=uR==-1?"none":"";if(uR>=0){byA.bJ(this.Jg[bgJ],"z-sel");byA.bK(this.Jg[uR],"z-sel");this.cZ=uR;this.hA(blZ.input.message,true);if(uR!=1){this.bAR(uR,0)}var byV=["at","private","comment","notify"];bj.gM("/?/frame/top/",{cmd:"msgtabchange",tab:byV[uR]})}};byx.hA=function(bn,VG){if(!!bn&&!!bn.data&&bn.data.cmd=="markread"&&bn.data.new){this.bAR(1,bn.data.new,!0);return}if(!VG){if(!this.bA.parentNode||!this.bA.parentNode.parentNode||!this.bA.parentNode.parentNode.tagName)return}if(!bn||bn.code!=200)return;for(var i=0,bg=["forward","msg","comment","notice"];i<bg.length;++i){if(VG){var dR=Math.max(bn[bg[i]]||0,0);this.iG[i].innerText=dR;this.iG[i].style.display=!dR?"none":""}else if((this.bA.style.display||"").trim().toLowerCase()=="none"){var dR=Math.max(bn[bg[i]]||0,0);this.iG[i].innerText=dR;this.iG[i].style.display=!dR?"none":""}else if(i==this.cZ&&bn[bg[i]]){if(i==1){this.bAR(1,Math.max(bn[bg[i]]||0,0),!1,!0)}else{this.bAR(i,0);this.bgt(i)}}else{var dR=Math.max(bn[bg[i]]||0,0);this.iG[i].innerText=dR;this.iG[i].style.display=!dR?"none":""}}};byx.Av=function(bs){var byH=localCache.cg("host"),byV=["at","private","comment","notify"];dispatcher.dr("/?/message/"+byV[bs]+"/?uid="+byH.profile.userId,{input:{parent:this.bA.parentNode}});bj.gM("/?/frame/top/",{cmd:"msgtabchange",tab:byV[bs]})};byx.bAR=function(bs,eK,cJv,cJB){bj.cnk(this.cJA.byB(this,bs,Math.max(eK||0,0),!!cJv),cJB?0:1e3,"message-tip-"+bs)};byx.cJA=function(bs,eK,cJv){if(cJv){eK=Math.max(parseInt(this.iG[bs].innerText||0)-eK,0)}if(eK==0){this.iG[bs].innerText="";this.iG[bs].style.display="none"}else{this.iG[bs].innerText=eK;this.iG[bs].style.display="block"}this.Hl(bs==0?"forward":bs==1?"msg":bs==2?"comment":"notice",eK)};byx.Hl=function(bq,eK){bj.gM("/?/frame/top/",{cmd:"onread",type:bq,"new":eK})};byx.bgt=function(bs){bj.gM("/?/message/"+["at","private","comment","notify","chat"][bs]+"/","onrefresh")};bj.cU("/?/message",bC.nN)})()</textarea>