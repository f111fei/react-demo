<meta charset="utf-8"/> <textarea name="txt" id="m-sprv-module"> <ol class="m-msglist m-msglist-1 s-layscroll"><ol> </textarea> <textarea name="ntp" id="m-sprv-item"> <li data-res-type="7" data-res-menu="true" data-res-from="-10"> <a data-action="redirect" href="javascript:void(0);" class="u-face u-face-6"><div class="wrap"><img class="j-flag"></div></a> <div class="msgcnt" data-action="chat"> <div class="who"> <a class="j-flag name s-fc2"></a> <sup class="j-flag f-dn"></sup> <span class="time"><time class="j-flag u-time s-fc4"></time></span> </div> <div class="j-flag msgsay f-thide"></div> </div> </li> </textarea> <textarea name="js">(function(){var byz=NEJ.P,cJO=NEJ.O,byA=byz("nej.e"),bi=byz("nej.v"),bm=byz("nej.u"),bj=byz("nm.x"),bxI=byz("nm.i"),bR=byz("nm.l"),byx,byD;bxI.bCC=NEJ.C();byx=bxI.bCC.bS(bxI.jg);byx.dH=function(){this.dI()};byx.eo=function(){this.Yl="m-sprv-item"};byx.byL=function(){this.byO();var bg=byA.bV(this.bA,"j-flag");this.xw=bg.shift();this.ow=bg.shift();this.bzy=bg.shift();this.sG=bg.shift();this.lC=bg.shift();bi.bM(this.bA,"click",this.ei.byB(this))};byx.gP=function(bh){if(!bh.id){byA.bK(this.bA,"f-dn");return}byA.bJ(this.bA,"f-dn");byA.bT(this.bA,"resId",bh.id);byA.bT(this.bA,"resData",bh.fromUser.userId);bh.newMsgCount>0?byA.bK(this.bA,"new"):byA.bJ(this.bA,"new");this.xw.src=bh.fromUser.avatarUrl+"?param=32y32&quality=100";this.ddA&&byA.lG(this.ddA);this.ddA=byA.xQ(ctl.commonJST.cFB("com-user-type-2",bh.fromUser,"flag"));this.ddA&&this.xw.parentNode.parentNode.appendChild(this.ddA);this.sG.innerText=bj.rP(bh.lastMsgTime,true);this.ow.innerHTML=bj.fg(bh.fromUser.nickname);this.ow.parentNode.appendChild(this.sG.parentNode);if(bm.eA(bh.lastMsg))bh.lastMsg=JSON.parse(bh.lastMsg);var cT=bh.lastMsg||cJO;switch(cT.type){case 1:case 14:var pr=cT.type==14?bj.cnh(cT.song):cT.song;var uE=bj.csw(pr);if(pr)this.lC.innerHTML='<span class="thide">单曲：「'+bj.fg(pr.name)+(uE?' (<span class="s-fc4">'+bj.fg(uE)+"</span>)":"")+"</span>」";break;case 2:var hV=cT.album;if(hV)this.lC.innerHTML='<span class="thide">专辑：「'+bj.fg(hV.name)+"</span>」";break;case 3:var jM=cT.artist;if(jM)this.lC.innerHTML='<span class="thide">歌手：「'+bj.fg(jM.name)+"</span>」";break;case 4:var dJ=cT.playlist;if(dJ)this.lC.innerHTML='<span class="thide">歌单：「'+bj.fg(dJ.name)+"</span>」";break;case 5:var dB=cT.program;if(dB)this.lC.innerHTML='<span class="thide">节目：「'+bj.fg(dB.name)+"</span>」";break;case 6:this.lC.innerHTML=bj.fg(cT.msg||"");break;case 7:var oH=cT.mv;if(oH)this.lC.innerHTML='<span class="thide">MV：「'+bj.fg(oH.name)+"</span>」";break;case 8:var bJB=cT.topic;if(bJB)this.lC.innerHTML='<span class="thide">专栏文章：「'+bj.fg(bJB.title)+"</span>」";break;case 10:var byH=cT.user;if(byH)this.lC.innerHTML='<span class="thide">名片：「'+bj.fg(byH.nickname)+"</span>」";break;case 11:var cbK=cT.activity;if(cbK)this.lC.innerHTML='<span class="thide">活动：「'+bj.fg(cbK.title)+"</span>」";break;case 12:var cbC=cT.promotionUrl;if(cbC){if(cT.msg){this.lC.innerHTML='<span class="thide">'+bj.fg(cbC.text)+"：「"+bj.fg(cT.msg)+"</span>」"}else{this.lC.innerHTML='<span class="thide">外链：「'+bj.fg(cbC.text)+"</span>」"}}break;case 13:var cnP=cT.djRadio;if(cnP)this.lC.innerHTML='<span class="thide">电台：「'+bj.fg(cnP.name)+"</span>」";break;case 15:this.lC.innerHTML="分享评论";break;default:this.lC.innerHTML='<p class="s-fc3">你当前的应用版本无法显示这条信息</p>';break}};byx.ei=function(byy){if(this.qk(byy))return;bi.bQd(byy);var eP={from:this.bW.fromUser.userId,type:"private"};var cT=this.bW.lastMsg||cJO;switch(cT.type){case 1:eP.object="song";eP.id=(cT.song||cJO).id;break;case 2:eP.object="album";eP.id=(cT.album||cJO).id;break;case 3:eP.object="artist";eP.id=(cT.artist||cJO).id;break;case 4:eP.object="list";eP.id=(cT.playlist||cJO).id;break;case 5:eP.object="dj";eP.id=(cT.program||cJO).id;break;case 6:eP.object="string";eP.id=0;break;case 7:eP.object="mv";eP.id=(cT.mv||cJO).id;break;case 8:eP.object="topic";eP.id=(cT.topic||cJO).id;break;case 10:eP.object="user";eP.id=(cT.user||cJO).id;break;case 11:eP.object="activity";eP.id=(cT.activity||cJO).id;break;case 12:eP.object="promotionUrl";eP.id=0;break;case 13:eP.object="djRadio";eP.id=(cT.djRadio||cJO).id;break;default:eP.object="unknow";eP.id=0}nm.log.dE("click","private",this.bW.id,eP);var bk=bi.cR(byy,"d:action");if(!bk)return;switch(byA.bT(bk,"action")){case"redirect":dispatcher.dr("/m/personal/?uid="+this.bW.fromUser.userId);this.bzj();break;case"chat":byA.bJ(this.bA,"new");var beH=this.bW.newMsgCount||0;this.bW.newMsgCount=0;this.bF("onaction",this.bW.fromUser.userId,this.bW.fromUser.nickname,beH);break}};byx.qk=function(byy){if(byA.ey(byy.srcElement,"j-atlink")){if(location.href!=byy.srcElement.href)location.href=byy.srcElement.href;this.bzj();return true}return false};byx.bzj=function(){dispatcher.gM({to:"/?/frame/top/",from:"",data:"onclose",mode:0})}})();
(function(){var byz=NEJ.P,cJO=NEJ.O,byA=byz("nej.e"),bi=byz("nej.v"),bU=byz("nej.ut"),bj=byz("nm.x"),bxI=byz("nm.i"),bp=byz("nm.d"),bY=byz("nm.m"),bC=byz("nm.m.s"),byx,byD;bC.Uu=NEJ.C();byx=bC.Uu.bS(bY.cW);byx.byG=function(){this.bCU="m-sprv";this.dg();this.bL={limit:15,parent:this.bA,sbody:this.bA,delta:30,item:{klass:bxI.bCC,onaction:this.zl.byB(this)},cache:{key:"id",klass:bp.bzn,clear:true,onlisterror:this.sZ.byP(this,this.bA)},onemptylist:this.bAe.byB(this,"暂无私信内容"),onafterlistload:this.bzK.byB(this),onbeforelistload:this.im.byB(this,"m-xwgt-white-list-loading"),onafterpullrefresh:this.og.byB(this),onbeforepullrefresh:this.im.byB(this,"m-xwgt-white-list-loading"),onbeforelistclear:this.bzb.byB(this),onafterlistrender:this.hR.byB(this)};this.bL.cache.onerror=this.ej.byP(this,true,this.bL.parent)};byx.dq=function(blZ){this.dC(blZ);byA.bJ(blZ.input.parent,"u-arrlay-chat");var bP=blZ.param||cJO,dM=blZ.input||cJO,Xk=bP.visit||dM.visit||!1;this.Ut=Xk;this.mH=true;var cJN=this.bL.cache,bZ=localCache.cF("host.profile.userId");cJN.lkey="message_private-"+bZ;if(!!this.cw)this.cw.bQ();this.cw=bU.jN.bG(this.bL)};byx.eR=function(){this.eV=this.bA.scrollTop;this.byU()};byx.zl=function(bZ,hy,eK){this.Hl(eK);dispatcher.dr("/?/message/chat/?userId="+bZ+"&nickname="+hy,{input:{parent:this.bA.parentNode,visit:this.Ut}})};byx.Hl=function(eK){bj.gM("/?/message",{cmd:"markread","new":eK||0})};byx.hR=function(){if(this.Ut&&this.mH){this.bA.scrollTop=this.eV;if(this.bA.scrollTop>=this.eV){this.mH=false}}};bj.cU("/?/message/private/",bC.Uu)})()</textarea>