<meta charset="utf-8"/> <textarea name="txt" id="m-scht-module"> <div class="msghd"> <div class="j-flag f-thide"></div> <span class="back j-flag"><svg><use xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#msg_back"></use></svg></span> </div> <div class="m-chartlist s-layscroll"> <div class="j-flag"></div> <ol class="j-flag"></ol> <div class="j-flag"></div> </div> </textarea> <textarea name="ntp" id="m-scht-item"> <li class="m-dlist m-dlist-msg"> <time class="date s-fc3"><em class="j-flag"></em></time> <a data-action="redirect" href="javascript:void(0);" class="j-flag u-face u-face-6"><div class="wrap"><img></div></a> <div class="chartcnt f-cb"> <div class="charttxt" data-res-type="7" data-res-menu="true" data-res-from="-11"> <svg class="before"><use xlink:href="orpheus://orpheus/style/res/svg/icon.sp.svg#msg_before"></use></svg> <div class="j-flag chartsay f-ust"></div> <a data-action="redirect2" href="javascript:void(0);" class="j-flag chartcite src s-fc3 f-cb"> <div class="u-cover u-cover-tn"><span class="lnk"><img class="j-flag"></span></div> <div class="j-flag cctxt f-thide2"></div> </a> <div class="j-flag"></div> </div> <div class="j-flag chartstatus f-dn"> <div class="u-load"></div> </div> <div class="j-flag chartstatus f-dn"> <span data-action="retry" class="s-fc2 f-cp f-tdu">重发</span><span class="u-icn3 u-icn3-warm"></span> </div> <time class="j-flag s-fc3"></time> </div> </li> </textarea> <textarea name="js">(function(){var byz=NEJ.P,cJO=NEJ.O,byA=byz("nej.e"),bi=byz("nej.v"),bm=byz("nej.u"),bD=byz("nej.n"),fH=byz("nej.cef"),bj=byz("nm.x"),bxI=byz("nm.i"),gD=byz("nm.w"),byx,byD;bxI.KC=NEJ.C();byx=bxI.KC.bS(bxI.jg);byx.dH=function(){this.dI();if(this.cmT){bj.cL(4,function(cJN){cJN.eN(this.cmT)}.byB(this));delete this.cmT}if(this.cJT){this.cJT.bQ();delete this.cJT}};byx.eo=function(){this.Yl="m-scht-item"};byx.byL=function(){this.byO();var bg=byA.bV(this.bA,"j-flag");this.bSZ=bg.shift();this.baR=bg.shift();this.qr=bg.shift();this.Jy=bg.shift();this.bAf=bg.shift();this.caZ=bg.shift();this.cYB=bg.shift();this.HM=bg.shift();this.Ht=bg.shift();this.sG=bg.shift();bi.bM(this.bA,"click",this.ei.byB(this))};byx.cJ=function(blZ){this.cK(blZ)};byx.gP=function(bh){if(!bh.id){byA.bK(this.bA,"f-dn");return}if(this.cJT){this.cJT.bQ();delete this.cJT}byA.bJ(this.bA,"f-dn");byA.bT(this.qr.parentNode,"resId",bh.id);this.dn=localCache.cF("host.profile.userId");var xJ=bh.toUser||{userId:0},bqE=bh.fromUser||{userId:0},tu=this.bvQ(bh.time);byA.bT(this.qr.parentNode,"resData",xJ.userId==this.dn?bqE.userId:xJ.userId);xJ.userId==this.dn?byA.bJ(this.bA,"me"):byA.bK(this.bA,"me");this.baR.style.display=xJ.userId==this.dn?"":"none";if(xJ.userId==this.dn)this.baR.firstChild.firstChild.src=bh.fromUser.avatarUrl+"?param=40y40&quality=100";this.ddA&&byA.lG(this.ddA);this.ddA=byA.xQ(ctl.commonJST.cFB("com-user-type-2",bh.fromUser,"flag"));this.ddA&&this.baR.appendChild(this.ddA);this.sG.innerText=tu.time;this.bSZ.innerText=tu.date;byA.bT(this.bA,"id",tu.id);var fN=this.bA.previousSibling;if(fN&&byA.bT(fN,"id")==tu.id){byA.bK(this.bSZ.parentNode,"f-dn")}else{byA.bJ(this.bSZ.parentNode,"f-dn")}if(!!bh.send){fN=this.bA.nextSibling;if(fN&&byA.bT(fN,"id")==tu.id){byA.bK((fN.getElementsByClassName("date")||[])[0],"f-dn")}}if(bh.msg&&bm.eA(bh.msg)){bh.msg=JSON.parse(bh.msg)}byA.bJ(this.bA,"txt");this.bAf.parentNode.parentNode.className="u-cover u-cover-tn";byA.bJ(this.Jy,"chartcite-1");this.CR();var cT=bh.msg;if(cT){this.Jy.style.display=cT.type==6?"none":"";this.cYB.style.display="none";if(cT.type<=9||cT.type==13||cT.type==14){byA.bEq(this.bAf.parentNode.parentNode,"u-cover-act","u-cover-tn");byA.bEq(this.caZ,"f-thide2","f-dn")}else{if(cT.type==10){byA.bEq(this.bAf.parentNode.parentNode,"u-cover-act","u-cover-tn")}else{byA.bEq(this.bAf.parentNode.parentNode,"u-cover-tn","u-cover-act")}byA.bEq(this.caZ,"f-dn","f-thide2")}var cWl=false;switch(cT.type){case 1:case 14:this.qr.innerHTML=(bj.lO(cT.title,{parseLink:!0})||"分享单曲")+"："+this.cDb(cT.msg);var pr=cT.type==14?this.cpu(cT.song):cT.song;cWl=!!cT.song;break;case 2:this.qr.innerHTML=(bj.lO(cT.title,{parseLink:!0})||"分享专辑")+"："+this.cDb(cT.msg);cWl=!!cT.album;break;case 3:this.qr.innerHTML=(bj.lO(cT.title,{parseLink:!0})||"分享歌手")+"："+this.cDb(cT.msg);cWl=!!cT.artist;break;case 4:this.qr.innerHTML=(bj.lO(cT.title,{parseLink:!0})||"分享歌单")+"："+this.cDb(cT.msg);cWl=!!cT.playlist;break;case 5:this.qr.innerHTML="分享节目："+this.cDb(cT.msg);cWl=!!cT.program;break;case 6:byA.bK(this.bA,"txt");this.qr.innerHTML=this.cDb(cT.msg);break;case 7:this.qr.innerHTML=(bj.lO(cT.title,{parseLink:!0})||"分享MV")+"："+this.cDb(cT.msg);cWl=!!cT.mv;break;case 8:this.qr.innerHTML=(bj.lO(cT.title,{parseLink:!0})||"分享专栏文章")+"："+this.cDb(cT.msg);cWl=!!cT.topic;break;case 10:this.qr.innerHTML=(bj.lO(cT.title,{parseLink:!0})||"分享用户")+"："+this.cDb(cT.msg);var byH=cT.user;if(byH){this.bAf.src=byH.avatarUrl+"?param=61y40&quality=100";this.caZ.innerText=byH.nickname}break;case 11:this.qr.innerHTML=(bj.lO(cT.title,{parseLink:!0})||"分享福利")+"："+this.cDb(cT.msg);var cbK=cT.activity;if(cbK){this.bAf.src=cbK.coverUrl+"?param=61y40&quality=100";this.caZ.innerText=cbK.title}break;case 12:var cbC=cT.promotionUrl||cJO;this.qr.innerHTML=(bj.lO(cbC.text||"",{parseLink:!0})||"分享外链")+"："+this.cDb(cT.msg);if(cbC.coverUrl&&cbC.title){this.bAf.src=cbC.coverUrl+"?param=61y40&quality=100";this.caZ.innerText=cbC.title}break;case 13:this.qr.innerHTML="分享电台："+this.cDb(cT.msg);cWl=!!cT.djRadio;break;case 15:this.qr.innerHTML="分享评论："+this.cDb(cT.msg);cWl=!!cT.comment;break;default:byA.bK(this.bA,"txt");this.qr.innerHTML='<p class="s-fc3">你当前的应用版本无法显示这条信息</p>';this.Jy.style.display="none";break}if(cWl){this.Jy.style.display="none";this.cYB.style.display="";this.cJT=gD.cKl.bG({place:"at",parent:this.cYB,resource:cT,simpleSong:cT.type==14,onplay:this.cNP.byB(this),afteraction:function(byy){var cX=byy.action||"";if(cX!="playsong"&&cX!="play"&&cX!="openurl"){this.bzj()}}.byB(this)})}}};byx.bvQ=function(cV){cV=new Date(cV);return{date:bj.bbh(cV),time:bm.rC(cV,"HH:mm"),id:bm.rC(cV,"yyyyMMdd")}};byx.cNP=function(Ji){if(Ji.song){bi.bF(document,"click",{res:{type:"4",action:"play",from:"-11",id:Ji.song.id,data:this.bW.id}})}else if(Ji.program){bi.bF(document,"click",{res:{type:"3",action:"play",from:"-11",id:Ji.program.id,data:this.bW.id}})}};byx.cpu=function(bB){bB=bj.cnh(bB);this.cAB=function(){this.cmT="track_chat-"+this.bW.id;bj.cL(4,function(cJN){cJN.hI(this.cmT,[bB])}.byB(this))};return bB};byx.bpc=function(sR){if(!sR||sR.length==0)return"";var bE=[];sR.forEach(function(artist){bE.push(artist.name)});return bE.join("/")};byx.ei=function(byy){if(this.qk(byy))return;var bk=bi.cR(byy,"d:action");if(!bk){return}switch(byA.bT(bk,"action")){case"redirect":dispatcher.dr("/m/personal/?uid="+this.bW.fromUser.userId);this.bzj();bi.bQd(byy);break;case"redirect2":switch(this.bW.msg.type){case 1:case 14:bi.bF(document,"click",{res:{type:"4",action:"play",from:"-11",id:this.bW.msg.song.id}});break;case 2:dispatcher.dr("/m/album/?id="+this.bW.msg.album.id);this.bzj();break;case 3:dispatcher.dr("/m/artist/?id="+this.bW.msg.artist.id);this.bzj();break;case 4:dispatcher.dr("/m/playlist/?id="+this.bW.msg.playlist.id);this.bzj();break;case 5:bi.bF(document,"click",{res:{type:"3",action:"play",from:"-11",id:this.bW.msg.program.id}});break;case 6:break;case 7:location.href="#/m2/mv/?source=msg&id="+this.bW.msg.mv.id;this.bzj();break;case 8:bj.caU("http://music.163.com/#/m/topic?id="+this.bW.msg.topic.id);break;case 10:dispatcher.dr("/m/personal/?uid="+this.bW.msg.user.userId);this.bzj();break;case 11:bj.caU(this.bW.msg.activity.url);break;case 12:bj.caU(this.bW.msg.promotionUrl.url);break;case 13:dispatcher.dr("/m/djradio/?id="+this.bW.msg.djRadio.id);this.bzj();break;default:break}bi.bQd(byy);break;case"retry":dispatcher.gM({to:"/?/message/chat/",from:"",data:{cmd:"retry",key:this.bW.id}});bi.bQd(byy);break}};byx.qk=function(byy){if(byA.ey(byy.srcElement,"j-atlink")){if(location.href!=byy.srcElement.href)location.href=byy.srcElement.href;this.bzj();return true}return false};byx.bzj=function(){dispatcher.gM({to:"/?/frame/top/",from:"",data:"onclose",mode:0})};byx.CR=function(dS){switch(dS||0){case 0:byA.bK(this.HM,"f-dn");byA.bK(this.Ht,"f-dn");break;case 1:byA.bK(this.Ht,"f-dn");byA.bJ(this.HM,"f-dn");break;case 2:byA.bK(this.HM,"f-dn");byA.bJ(this.Ht,"f-dn");break}};byx.bIw=function(bh){this.bW=bh;this.gP(bh)};byx.cDb=function(gE){return bj.lO(gE,{parseLink:!0,cFx:!0})}})();
(function(){var byz=NEJ.P,cJO=NEJ.O,byA=byz("nej.e"),bi=byz("nej.v"),bU=byz("nej.ut"),bTG=byz("nm.c"),bj=byz("nm.x"),bxI=byz("nm.i"),bp=byz("nm.d"),bR=byz("nm.l"),bY=byz("nm.m"),bC=byz("nm.m.s"),byx,byD;bC.XL=NEJ.C();byx=bC.XL.bS(bY.cW);byx.byG=function(){this.bCU="m-scht";this.dg();this.cWk=byA.Vx("m-xwgt-replier");var bg=byA.bV(this.cWk,"j-flag");bg[0].className="m-editor m-editor-sm m-editor-chat";this.dbF=bg[2].lastElementChild;byA.bK(bg[8],"f-dn");byA.bK(bg[9],"f-dn");bg=byA.bV(this.bA,"j-flag");this.blO=bg[0];this.uj=bg[3];this.bL={limit:10,parent:bg[3],sbody:bg[3].parentNode,delta:30,item:{klass:bxI.KC},cache:{klass:bp.bzn,clear:true,onitemadd:this.bld.byB(this),onaddchaterr:this.bkS.byB(this),onlisterror:this.sZ.byP(this,bg[3]),onchattip:this.cFc.byB(this)},onemptylist:this.bAe.byB(this,"暂无私信"),onafterlistload:this.bzK.byB(this),onbeforelistload:this.im.byB(this,"m-xwgt-white-list-loading"),onafterpullrefresh:this.og.byB(this),onbeforepullrefresh:this.im.byB(this,"m-xwgt-white-list-loading"),onbeforelistclear:this.bzb.byB(this),onafterlistrender:this.hR.byB(this)};this.bL.cache.onerror=this.ej.byP(this,true,this.bL.parent);this.dG={onelinewords:48,parent:bg[2],remain:true,maxLen:200,hideAt:true,hideHash:true,editorClazz:"m-editor m-editor-chat",onreply:this.bkI.byB(this)};this.hz={};bi.bM(bg[1],"click",this.nS.byB(this));bi.bM(this.bA,"click",this.btw.byB(this));bi.bM(bp.bzn,"listchange",this.ku.byB(this));bi.bM(bTG.beh,"switch",this.bKu.byB(this))};byx.dq=function(blZ){this.dC(blZ);var bP=blZ.param||cJO,dM=blZ.input||cJO,cJN=this.bL.cache,Xk=bP.visit||dM.visit||!1;dM.parent&&byA.bK(dM.parent,"u-arrlay-chat");this.dn=bP.userId;if(localCache.cF("host.profile.userId")==this.dn){this.nS();return}this.bL.item.uid=this.dn;cJN.lkey="message_chat-"+this.dn;cJN.data=NEJ.X({},bP);this.blO.innerText=bP.nickname||"";this.gP();if(!!this.ck)this.ck.bQ();byA.kO(this.cWk);this.dG.widthSet=this.dn==(APP_CONF.domain.indexOf("igame")<0?9003:206001);this.dbF.innerText=this.dG.placeholder=bP.nickname?"回复 "+bP.nickname+":":"回复：";this.dG.msgKey=cJN.lkey;if(bj.btm()){this.dG.parent.appendChild(this.cWk);byA.bT(this.cWk,"anonAction","login")}else{this.ck=bj.bzS.bG(this.dG);this.ck.xP()}this.bjz=bP.ext;this.xH=false;bj.gM("/?/frame/top/",{cmd:"msgtabchange",tab:"chat",ext:{cmd:"onchat",userId:this.dn,nickname:bP.nickname||""}})};byx.gP=function(){this.bIv();this.hz={};if(!!this.cw)this.cw.bQ();this.cw=bU.jN.bG(this.bL)};byx.bIv=function(){if(!!this.hz){for(var bu in this.hz){var bl=this.hz[bu];if(!!bl&&!!bl.bQ){delete this.hz[bu];bl.bQ(bl)}}}};byx.eR=function(){this.eV=this.uj.parentNode.scrollTop;this.byU(!0);byA.kO(this.cWk);if(this.jJ)byA.lG(this.jJ);delete this.jJ};byx.bkI=function(bh){this.xH=true;this.WF(bh.content,bh.id);this.ck.btp()};byx.biw=function(bu){var bl=this.hz[bu];if(bl){bl.CR(1);this.WF(bl.bW.msg.msg,bu)}};byx.WF=function(cv,bu){this.cw.dE({id:0,type:"text",userIds:"["+this.dn+"]",msg:cv,ext:{key:bu}})};byx.biV=function(cv){var bh={formUser:localCache.cF("host.profile"),toUser:{userId:this.dn},msg:{msg:cv,type:6},time:(new Date).getTime(),id:(new Date).getTime()+"",send:true};var bl=bxI.KC.bG({data:bh});bl.CR(1);if(this.uj.firstElementChild&&this.uj.firstElementChild.tagName.toLowerCase()=="li"){this.uj.insertBefore(bl.bA,this.uj.firstElementChild)}else{this.uj.innerHTML="";this.uj.appendChild(bl.bA)}this.hz[bh.id]=bl;return bl};byx.bld=function(blZ){if(this.xH){this.xH=false}var bFo=(blZ||cJO).data,bFk=bFo.extId,bl=this.hz[bFk];if(!!bl){delete this.hz[bFk];delete bFo.extId;bl.CR(0);bl.bQ(bl)}};byx.bkS=function(bn,blZ){if(this.xH){this.xH=false}if(bn.code==405){bj.ci({txt:"输入过于频繁，请稍后再试！"})}else if(bn.code==407){bj.ci({txt:"您输入的内容包含了敏感词汇，请重新检查"})}else if(bn.code==315){bj.ci({txt:"根据对方设置，你没有该操作权限"})}else{bj.ci({txt:"发送失败，请稍后再试！"})}if(blZ&&blZ.data&&blZ.data.ext&&this.hz[blZ.data.ext.key]){this.hz[blZ.data.ext.key].CR(2)}};byx.xU=function(bu){var bl=this.hz[bu];if(bl){if(bl.bA.nextElementSibling){bl.bA.removeChild(bl.bA)}else{this.gP()}delete this.hz[bu];bl.bQ()}};byx.nS=function(){dispatcher.dr("/?/message/private/",{input:{parent:this.bA.parentNode,visit:this.bjz?!1:!0}})};byx.hA=function(bn){if(bn&&bn.data=="onrefresh"){this.gP();return}if(bn&&bn.data){switch(bn.data.cmd){case"retry":this.biw(bn.data.key);return;case"deletecustomitem":var bo=bn.data.ext,bl=(this.hz||cJO)[bo];if(!!bl){delete this.hz[bo];bl.bQ(bl)}return}}};byx.hR=function(){};byx.ku=function(byy){if(byy&&byy.key==this.bL.cache.lkey){}};byx.cFc=function(mB){if(this.jJ)return;this.jJ=byA.xQ('<div class="blacknote f-pr">'+mB+'<span data-action="closetip" class="cls u-ibtn f-pa" title="关闭"></span></div>');this.bL.parent.insertAdjacentElement("beforeBegin",this.jJ)};byx.btw=function(byy){var bk=bi.cR(byy,"d:action");switch(byA.bT(bk,"action")){case"closetip":byA.lG(bk.parentNode);break}};byx.bKu=function(){this.bzj()};byx.bzj=function(){dispatcher.gM({to:"/?/frame/top/",from:"",data:"onclose",mode:0})};bj.cU("/?/message/chat/",bC.XL)})()</textarea>